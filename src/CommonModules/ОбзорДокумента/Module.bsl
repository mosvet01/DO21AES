
// Выводит картинки состояний в карточке документа
Процедура ВывестиСтрокуСостояний(Форма) Экспорт 
	
	Элементы = Форма.Элементы;
	Объект = Форма.Объект;
	
	КешИнформации = РегистрыСведений.КешИнформацииОбОбъектах.СоздатьМенеджерЗаписи();
	КешИнформации.Объект = Объект.Ссылка;
	КешИнформации.Прочитать();
	
	// Картинка Взаимодействие
	Элементы.КартинкаВзаимодействие.Видимость = ПолучитьФункциональнуюОпцию("ИспользоватьБизнесПроцессыИЗадачи");
	Если КешИнформации.ЕстьЗадачи Тогда 
		Форма.СтатусВзаимодействие = 1;
		Элементы.КартинкаВзаимодействие.Подсказка = НСтр("ru = 'Есть выполняющиеся задачи'");
	Иначе	
		Форма.СтатусВзаимодействие = 0;
		Элементы.КартинкаВзаимодействие.Подсказка = НСтр("ru = 'Нет выполняющихся задач'");
	КонецЕсли;	
	
	// Картинка ЭП
	Элементы.КартинкаЭП.Видимость = ПолучитьФункциональнуюОпцию("ИспользоватьЭлектронныеПодписи");
	ВывестиКартинкуЭП(Форма);
	
	// Картинка Категории
	Элементы.КартинкаКатегории.Видимость = ПолучитьФункциональнуюОпцию("ИспользоватьКатегорииДанных");
	Если Форма.СписокКатегорийДанных.Количество() > 0 Тогда 
		Форма.СтатусКатегории = 1;
		Элементы.КартинкаКатегории.Подсказка = НСтр("ru = 'Есть категории'");
	Иначе
		Форма.СтатусКатегории = 0;
		Элементы.КартинкаКатегории.Подсказка = НСтр("ru = 'Нет категорий'");
	КонецЕсли;	
	
	// Картинка СВД 
	Если ТипЗнч(Объект.Ссылка) = Тип("СправочникСсылка.ВходящиеДокументы") Тогда 
		Элементы.КартинкаСВД.Видимость = РаботаССВД.ДоступнаРаботаСЭДО();
		Если КешИнформации.ПолученПоСВД = Истина Тогда 
			Форма.СтатусСВД = 1;
			Элементы.КартинкаСВД.Подсказка = НСтр("ru = 'Поступил по СВД'");
		Иначе
			Форма.СтатусСВД = 0;
			Элементы.КартинкаСВД.Подсказка = НСтр("ru = 'Поступил не по СВД'");
		КонецЕсли;	
	ИначеЕсли ТипЗнч(Объект.Ссылка) = Тип("СправочникСсылка.ИсходящиеДокументы") Тогда 
        Если не Форма.НесколькоПолучателей Тогда
            Элементы.СостояниеПроцессаВСВД.Видимость = РаботаССВД.ДоступнаРаботаСЭДО();
            Форма.СостояниеПроцессаВСВД = 
            ОбщегоНазначения.ЗначениеРеквизитаОбъекта(КешИнформации.СостояниеСВД, "НомерКартинкиВКоллекции");
            
            Если Форма.СостояниеПроцессаВСВД = 1 Тогда 
                Элементы.СостояниеПроцессаВСВД.Подсказка = НСтр("ru = 'В очереди на отправку по СВД'");
            ИначеЕсли Форма.СостояниеПроцессаВСВД = 2 Тогда 
                Элементы.СостояниеПроцессаВСВД.Подсказка = НСтр("ru = 'Отправлен по СВД'");
            ИначеЕсли Форма.СостояниеПроцессаВСВД = 3 Тогда 
                Элементы.СостояниеПроцессаВСВД.Подсказка = НСтр("ru = 'Доставлен по СВД'");
            ИначеЕсли Форма.СостояниеПроцессаВСВД = 4 Тогда 
                Элементы.СостояниеПроцессаВСВД.Подсказка = НСтр("ru = 'Зарегистрирован у получателя по СВД'");
            ИначеЕсли Форма.СостояниеПроцессаВСВД = 6 Тогда 
                Элементы.СостояниеПроцессаВСВД.Подсказка = НСтр("ru = 'Ошибка отправки по СВД'");			
            КонецЕсли;	
        КонецЕсли;
	
	КонецЕсли;	
	
	ВывестиКартинкуФорума(Форма);
	
	// Картинка контроль
	Элементы.КартинкаКонтроль.Видимость = ПолучитьФункциональнуюОпцию("ИспользоватьКонтрольОбъектов");
	ВывестиКартинкуКонтроля(Форма);
	
КонецПроцедуры	

// Выводит картинку наличия обсуждений
Процедура ВывестиКартинкуФорума(Форма) Экспорт 
	
	Элементы = Форма.Элементы;
	Объект = Форма.Объект;
	
	// Картинка Форум
	ИспользоватьОбсуждения = ПолучитьФункциональнуюОпцию("ИспользоватьОбсуждения");
	Элементы.КартинкаФорум.Видимость = ИспользоватьОбсуждения;
	Если ИспользоватьОбсуждения Тогда
		Тема = РаботаСОбсуждениями.НайтиТемуПоПредмету(Объект.Ссылка);
		Если Тема = Неопределено Тогда 
			Форма.СтатусФорум = 0;
			Элементы.КартинкаФорум.Подсказка = НСтр("ru = 'Нет обсуждения'");
		Иначе
			Форма.СтатусФорум = 1;
			Элементы.КартинкаФорум.Подсказка = НСтр("ru = 'Есть обсуждение'");
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

// Выводит картинку состояния ЭП
Процедура ВывестиКартинкуЭП(Форма) Экспорт 
	
	Если Не ПолучитьФункциональнуюОпцию("ИспользоватьЭлектронныеПодписи") Тогда 
		Возврат;
	КонецЕсли;	
	
	Элементы = Форма.Элементы;
	Объект = Форма.Объект;
	
	КешИнформации = РегистрыСведений.КешИнформацииОбОбъектах.СоздатьМенеджерЗаписи();
	КешИнформации.Объект = Объект.Ссылка;
	КешИнформации.Прочитать();
	
	Если ДелопроизводствоКлиентСервер.ЭтоДокумент(Объект.Ссылка) Тогда
	
		Если КешИнформации.СтатусЭП = Перечисления.СтатусПроверкиЭП.ПодписиНет Тогда
			Форма.СтатусЭП = 0;
			Элементы.КартинкаЭП.Подсказка = НСтр("ru = 'Не подписан электронной подписью'");
		ИначеЕсли КешИнформации.СтатусЭП = Перечисления.СтатусПроверкиЭП.ПодписьНеПроверена Тогда
			Форма.СтатусЭП = 1;
			Элементы.КартинкаЭП.Подсказка = НСтр("ru = 'Подписан электронной подписью. Подпись не проверена.'");
		ИначеЕсли КешИнформации.СтатусЭП = Перечисления.СтатусПроверкиЭП.ПодписьДействительна Тогда 
			Форма.СтатусЭП = 2;
			Элементы.КартинкаЭП.Подсказка = НСтр("ru = 'Подписан электронной подписью. Подпись действительна.'");
		ИначеЕсли КешИнформации.СтатусЭП = Перечисления.СтатусПроверкиЭП.ПодписьНедействительна Тогда 
			Форма.СтатусЭП = 3;
			Элементы.КартинкаЭП.Подсказка = НСтр("ru = 'Подписан электронной подписью. Подпись недействительна.'");
		Иначе 
			Если Объект.ПодписанЭП Тогда
				Форма.СтатусЭП = 1;
				Элементы.КартинкаЭП.Подсказка = НСтр("ru = 'Подписан электронной подписью. Подпись не проверена.'");
			Иначе 
				Форма.СтатусЭП = 0;
				Элементы.КартинкаЭП.Подсказка = НСтр("ru = 'Не подписан электронной подписью'");
			КонецЕсли;
		КонецЕсли;
	
	ИначеЕсли ДелопроизводствоКлиентСервер.ЭтоФайл(Объект.Ссылка) Тогда
		
		Если Объект.Ссылка.Зашифрован Тогда
			Если КешИнформации.СтатусЭП = Перечисления.СтатусПроверкиЭП.ПодписиНет Тогда
				Форма.СтатусЭП = 1;
				Элементы.КартинкаЭП.Подсказка = НСтр("ru = 'Зашифрован. Не подписан электронной подписью'");
			ИначеЕсли КешИнформации.СтатусЭП = Перечисления.СтатусПроверкиЭП.ПодписьНеПроверена Тогда
				Форма.СтатусЭП = 3;
				Элементы.КартинкаЭП.Подсказка = НСтр("ru = 'Зашифрован. Подписан электронной подписью. Подпись не проверена.'");
			ИначеЕсли КешИнформации.СтатусЭП = Перечисления.СтатусПроверкиЭП.ПодписьДействительна Тогда 
				Форма.СтатусЭП = 5;
				Элементы.КартинкаЭП.Подсказка = НСтр("ru = 'Зашифрован. Подписан электронной подписью. Подпись действительна.'");
			ИначеЕсли КешИнформации.СтатусЭП = Перечисления.СтатусПроверкиЭП.ПодписьНедействительна Тогда 
				Форма.СтатусЭП = 7;
				Элементы.КартинкаЭП.Подсказка = НСтр("ru = 'Зашифрован. Подписан электронной подписью. Подпись недействительна.'");
			Иначе
				Если Объект.ПодписанЭП Тогда
					Форма.СтатусЭП = 3;
					Элементы.КартинкаЭП.Подсказка = НСтр("ru = 'Зашифрован. Подписан электронной подписью. Подпись не проверена.'");
				Иначе
					Форма.СтатусЭП = 1;
					Элементы.КартинкаЭП.Подсказка = НСтр("ru = 'Зашифрован. Не подписан электронной подписью'");
				КонецЕсли;
			КонецЕсли;
		Иначе
			Если КешИнформации.СтатусЭП = Перечисления.СтатусПроверкиЭП.ПодписиНет Тогда
				Форма.СтатусЭП = 0;
				Элементы.КартинкаЭП.Подсказка = НСтр("ru = 'Не подписан электронной подписью'");
			ИначеЕсли КешИнформации.СтатусЭП = Перечисления.СтатусПроверкиЭП.ПодписьНеПроверена Тогда
				Форма.СтатусЭП = 2;
				Элементы.КартинкаЭП.Подсказка = НСтр("ru = 'Подписан электронной подписью. Подпись не проверена.'");
			ИначеЕсли КешИнформации.СтатусЭП = Перечисления.СтатусПроверкиЭП.ПодписьДействительна Тогда 
				Форма.СтатусЭП = 4;
				Элементы.КартинкаЭП.Подсказка = НСтр("ru = 'Подписан электронной подписью. Подпись действительна.'");
			ИначеЕсли КешИнформации.СтатусЭП = Перечисления.СтатусПроверкиЭП.ПодписьНедействительна Тогда 
				Форма.СтатусЭП = 6;
				Элементы.КартинкаЭП.Подсказка = НСтр("ru = 'Подписан электронной подписью. Подпись недействительна.'");
			Иначе
				Если Объект.ПодписанЭП Тогда
					Форма.СтатусЭП = 2;
					Элементы.КартинкаЭП.Подсказка = НСтр("ru = 'Подписан электронной подписью. Подпись не проверена.'");
				Иначе
					Форма.СтатусЭП = 0;
					Элементы.КартинкаЭП.Подсказка = НСтр("ru = 'Не подписан электронной подписью'");
				КонецЕсли;
			КонецЕсли;
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры	

Процедура ВывестиКартинкуКонтроля(Форма) Экспорт 
	
	Если Не ПолучитьФункциональнуюОпцию("ИспользоватьКонтрольОбъектов") Тогда 
		Возврат;
	КонецЕсли;	
	
	Элементы = Форма.Элементы;
	Объект = Форма.Объект;
	
	КешИнформации = РегистрыСведений.КешИнформацииОбОбъектах.СоздатьМенеджерЗаписи();
	КешИнформации.Объект = Объект.Ссылка;
	КешИнформации.Прочитать();
	
	ТекущаяДата = НачалоДня(ТекущаяДатаСеанса());
	
	Если Не ЗначениеЗаполнено(КешИнформации.СостояниеКонтроля) Тогда 
		
		Форма.СтатусКонтроля = 5; 
		Элементы.КартинкаКонтроль.Подсказка = НСтр("ru = 'Не стоит на контроле'");
		
	ИначеЕсли КешИнформации.СостояниеКонтроля = Перечисления.СостоянияКонтроля.НаКонтроле Тогда 
		
		Если Не ЗначениеЗаполнено(КешИнформации.СрокИсполнения) Или КешИнформации.СрокИсполнения >= ТекущаяДата Тогда 
			Форма.СтатусКонтроля = 1;
			Элементы.КартинкаКонтроль.Подсказка = НСтр("ru = 'На контроле'");
		Иначе	
			Форма.СтатусКонтроля = 3;
			Элементы.КартинкаКонтроль.Подсказка = НСтр("ru = 'На контроле'");
		КонецЕсли;	
		
	ИначеЕсли КешИнформации.СостояниеКонтроля = Перечисления.СостоянияКонтроля.СнятСКонтроля Тогда 	
		
		Форма.СтатусКонтроля = 4;
		Элементы.КартинкаКонтроль.Подсказка = НСтр("ru = 'Снят с контроля'");
		
	ИначеЕсли КешИнформации.СостояниеКонтроля = Перечисления.СостоянияКонтроля.НаКонтролеНесколько Тогда 
		
		 Если Не ЗначениеЗаполнено(КешИнформации.СрокИсполнения) Или КешИнформации.СрокИсполнения >= ТекущаяДата Тогда 
			Форма.СтатусКонтроля = 6;
		ИначеЕсли Не ЗначениеЗаполнено(КешИнформации.СрокИсполненияОбщий) Или КешИнформации.СрокИсполненияОбщий >= ТекущаяДата Тогда 
			Форма.СтатусКонтроля = 9;
		Иначе
			Форма.СтатусКонтроля = 7;
		КонецЕсли;	
		Элементы.КартинкаКонтроль.Подсказка = НСтр("ru = 'На контроле (несколько)'");
		
	ИначеЕсли КешИнформации.СостояниеКонтроля = Перечисления.СостоянияКонтроля.СнятСКонтроляНесколько Тогда
		
		Форма.СтатусКонтроля = 8;
		Элементы.КартинкаКонтроль.Подсказка = НСтр("ru = 'Снят с контроля (несколько)'");
		
	ИначеЕсли КешИнформации.СостояниеКонтроля = Перечисления.СостоянияКонтроля.СмешанноНесколько Тогда	
		
		Если Не ЗначениеЗаполнено(КешИнформации.СрокИсполнения) Или КешИнформации.СрокИсполнения >= ТекущаяДата Тогда 
			Форма.СтатусКонтроля = 10;
		Иначе
			Форма.СтатусКонтроля = 11;
		КонецЕсли;
		Элементы.КартинкаКонтроль.Подсказка = НСтр("ru = 'На контроле и снят с контроля'");
		
	КонецЕсли;	
	
КонецПроцедуры	

Процедура ВывестиКартинкуЭДО(Форма) Экспорт 
	
	Если Не ОбщегоНазначенияБЭД.ЗначениеФункциональнойОпции("ИспользоватьОбменЭД") 
			Или Форма.ВариантПодписания = Перечисления.ВариантыПодписания.НеПодписывается Тогда
			
		Возврат;
	КонецЕсли;	
	
	Элементы = Форма.Элементы;
	Объект = Форма.Объект;
	
	СостояниеЭДО = ОбменСКонтрагентамиДОВызовСервера.ДанныеСостоянияДокументаПоЭДО(Объект.Ссылка);
	
	Элементы.КартинкаЭДО.Подсказка = "";
	Если Не ЗначениеЗаполнено(СостояниеЭДО) Тогда 
		
		Форма.СтатусЭДО = 0; 
		
	ИначеЕсли СостояниеЭДО = Перечисления.СостоянияЭДОДокументооборот.ПоставленВОчередьНаОтправку
		Или СостояниеЭДО = Перечисления.СостоянияЭДОДокументооборот.ОжидаетсяОтправка
		Или СостояниеЭДО = Перечисления.СостоянияЭДОДокументооборот.Отправлен 
		Или СостояниеЭДО = Перечисления.СостоянияЭДОДокументооборот.ОбменЗавершен
		Или СостояниеЭДО = Перечисления.СостоянияЭДОДокументооборот.ОбменЗавершенСИсправлением
		Или СостояниеЭДО = Перечисления.СостоянияЭДОДокументооборот.Аннулирован
		Или СостояниеЭДО = Перечисления.СостоянияЭДОДокументооборот.ОжидаетсяПодтверждениеАннулирования
		Или СостояниеЭДО = Перечисления.СостоянияЭДОДокументооборот.ОжидаетСозданияПакетаЭДО
		Или СостояниеЭДО = Перечисления.СостоянияЭДОДокументооборот.Подписан Тогда
		
		Форма.СтатусЭДО = 1; 
		
	ИначеЕсли СостояниеЭДО = Перечисления.СостоянияЭДОДокументооборот.ОтклоненПолучателем
		Или СостояниеЭДО = Перечисления.СостоянияЭДОДокументооборот.ЗакрытСОтклонением
		Или СостояниеЭДО = Перечисления.СостоянияЭДОДокументооборот.ТребуетсяУточнение
		Или СостояниеЭДО = Перечисления.СостоянияЭДОДокументооборот.ОжидаетсяИсправление
		Или СостояниеЭДО = Перечисления.СостоянияЭДОДокументооборот.ОшибкаПередачи
		Или СостояниеЭДО = Перечисления.СостоянияЭДОДокументооборот.ТребуетсяАннулировать Тогда
			
		Форма.СтатусЭДО = 2; 
		
	Иначе
			
		Форма.СтатусЭДО = 3; 
		
	КонецЕсли;
	
КонецПроцедуры	

// Возвращает текст HTML для показа обзора внутреннего документа
Функция ПолучитьОбзорВнутреннегоДокумента(Форма) Экспорт 
	
	HTMLТекст = ОбзорДокументаПереопределяемый.ПолучитьОбзорВнутреннегоДокумента(Форма);
	Если ЗначениеЗаполнено(HTMLТекст) Тогда 
		Возврат HTMLТекст;
	КонецЕсли;
		
	ПараметрыУчета = Новый Структура;
	ПараметрыУчета.Вставить("ВестиУчетСторон", Ложь);
	ПараметрыУчета.Вставить("ВестиУчетПоКонтрагентам", Ложь);
	
	Объект = Форма.Объект;
	Если ЗначениеЗаполнено(Объект.ВидДокумента) Тогда
		ПараметрыУчета = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(
			Объект.ВидДокумента,
			"ВестиУчетСторон, ВестиУчетПоКонтрагентам");
	КонецЕсли;
	
	Если ПараметрыУчета.ВестиУчетСторон Или ПараметрыУчета.ВестиУчетПоКонтрагентам Тогда
		Возврат ПолучитьОбзорВнутреннегоДокументаСКонтрагентом(Форма);
	Иначе
		Возврат ПолучитьОбзорВнутреннегоДокументаБезКонтрагента(Форма);
	КонецЕсли;
	
КонецФункции

// Возвращает текст HTML для показа обзора исходящего документа
Функция ПолучитьОбзорИсходящегоДокумента(Форма) Экспорт 
	
	HTMLТекст = ОбзорДокументаПереопределяемый.ПолучитьОбзорИсходящегоДокумента(Форма);
	Если ЗначениеЗаполнено(HTMLТекст) Тогда 
		Возврат HTMLТекст;
	КонецЕсли;
	
	Объект = Форма.Объект;
	Организация = Объект.Организация;

	// Формируем основное представление документа	
	HTMLТекст = "<html>
	|<head>
	|<style type=""text/css"">
	|	body {
	|		overflow:    auto;
	|		margin-top:  6px; 		 
	|		margin-left: 10px; 
	|		margin-bottom: 0px;
	|		font-family: Arial, sans-serif;
	|		font-size:   10pt;}
	|	table {
	|		width:       100%;
	|		font-family: Arial, sans-serif;
	|		font-size:   10pt;}
	|	td {vertical-align: top;}
	| 	a:link {
	|		color: #006699; text-decoration: none;}
	|	a:visited {
	|		color: #006699; text-decoration: none;}
	|	a:hover {
	|		color: #006699; text-decoration: underline;}
	|	p {
	|		margin-top: 7px;}
	|</style>
	|<body>";
	
	HTMLТекст = HTMLТекст + "<table>";
	HTMLТекст = HTMLТекст + "<tr>";
	
	HTMLТекст = HTMLТекст + "<td width=""40%"" align=center >";
	ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'От кого:'"), "");
	HTMLТекст = HTMLТекст + "<p>";
	ДобавитьРеквизит(HTMLТекст, "", Организация);
	
	Если ЗначениеЗаполнено(Объект.ВидДокумента) Тогда 
		HTMLТекст = HTMLТекст + "<p>";
		HTMLТекст = HTMLТекст + СтрШаблон(
			"<A href=v8doc:%1>%2</A>",
			ПолучитьНавигационнуюСсылку(Объект.ВидДокумента),
			ВРег(РаботаС_HTML.ЗаменитьСпецСимволыHTML((Строка(Объект.ВидДокумента)))));
		HTMLТекст = HTMLТекст + "<p>";
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Объект.ДатаРегистрации) И ЗначениеЗаполнено(Объект.РегистрационныйНомер) Тогда 
		ДобавитьРеквизит(HTMLТекст, "", Формат(Объект.ДатаРегистрации, "ДЛФ=D") 
		+ " № " +  Объект.РегистрационныйНомер);
	Иначе
		ДобавитьРеквизит(HTMLТекст, "________ №________", "");
	КонецЕсли;
	HTMLТекст = HTMLТекст + "<p>";
	
	Если ЗначениеЗаполнено(Форма.ВОтветНаСтрока) Тогда 
		Если Лев(Форма.ВОтветНаСтрока, 1) = "№" Тогда 
			ДобавитьПодпись(HTMLТекст, НСтр("ru = 'На'") + " ");
			HTMLТекст = HTMLТекст + СтрШаблон(
				"<A href=v8doc:%1>%2</A><BR>",
				ПолучитьНавигационнуюСсылку(Форма.ВОтветНа),
				Форма.ВОтветНаСтрока);
		ИначеЕсли Лев(Форма.ВОтветНаСтрока, 6) = "Исх. №" Тогда 
			ДобавитьПодпись(HTMLТекст, НСтр("ru = 'На'") + " ");
			HTMLТекст = HTMLТекст + СтрШаблон(
				"<A href=v8doc:%1>%2</A><BR>",
				ПолучитьНавигационнуюСсылку(Форма.ВОтветНа),
				Прав(Форма.ВОтветНаСтрока, СтрДлина(Форма.ВОтветНаСтрока) - 5));
		Иначе
			ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'На №_______ от _______'"), "");
		КонецЕсли;
	Иначе
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'На №_______ от _______'"), "");
	КонецЕсли;
	HTMLТекст = HTMLТекст + "</td>";	
	
	HTMLТекст = HTMLТекст + "<td>";
	HTMLТекст = HTMLТекст + "</td>";
	
	HTMLТекст = HTMLТекст + "<td width=""40%"">";
	Если Форма.НесколькоПолучателей Тогда
		Количество = 0;
		Для Каждого Получателя Из Объект.Получатели Цикл
			Если ЗначениеЗаполнено(Получателя.Получатель) Тогда
				Количество = Количество + 1;
			КонецЕсли;
		КонецЦикла;
		
		Если Количество > 0 Тогда 
			Если Количество = 1 Тогда 
				ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Кому:'"), "");
			Иначе 
				ДобавитьРеквизит(HTMLТекст, СтрШаблон(
					НСтр("ru = 'Кому (%1):'"), Количество), "");
			КонецЕсли;
			
			Для Каждого Получателя Из Объект.Получатели Цикл
				HTMLТекст = HTMLТекст + "<p>";
				ДобавитьРеквизит(HTMLТекст, "", Получателя.Получатель);
				
				Если ЗначениеЗаполнено(Получателя.Адресат) Тогда
					ДобавитьВТекстДанныеКонтактногоЛица(Получателя.Адресат, HTMLТекст, "");
				КонецЕсли;
			КонецЦикла;
		КонецЕсли;
	Иначе
	    Если ЗначениеЗаполнено(Форма.Получатель) Тогда
			ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Кому:'"), "");
			HTMLТекст = HTMLТекст + "<p>";
			
			ДобавитьРеквизит(HTMLТекст, "", Форма.Получатель);
			
			Если ЗначениеЗаполнено(Форма.Адресат) Тогда
				ДобавитьВТекстДанныеКонтактногоЛица(Форма.Адресат, HTMLТекст, "");
			КонецЕсли;
		КонецЕсли;	
	КонецЕсли;
	
	HTMLТекст = HTMLТекст + "</td>";
	HTMLТекст = HTMLТекст + "</tr>";
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""3"">";
	
	HTMLТекст = HTMLТекст + "<p>";
	Заголовок = Объект.Заголовок;
	HTMLТекст = HTMLТекст + СтрШаблон(
		"<B>%1</B>",
		РаботаС_HTML.ЗаменитьСпецСимволыHTML(Заголовок));
	HTMLТекст = HTMLТекст + "<p>";	
	
	Если ЗначениеЗаполнено(Объект.ВидДокумента) Тогда 
		РеквизитыВида = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(Объект.ВидДокумента,
			"УчитыватьСуммуДокумента, ИспользоватьСрокИсполнения, ВестиУчетПоНоменклатуреДел, 
			|ИспользоватьЭтапыОбработкиДокумента, УчитыватьМестоХранения, УчитыватьОтветственногоЗаХранение");
	Иначе 
		РеквизитыВида = Новый Структура;
		РеквизитыВида.Вставить("УчитыватьСуммуДокумента", Ложь);
		РеквизитыВида.Вставить("ИспользоватьСрокИсполнения", Ложь);
		РеквизитыВида.Вставить("ВестиУчетПоНоменклатуреДел", Ложь);
		РеквизитыВида.Вставить("ИспользоватьЭтапыОбработкиДокумента", Ложь);
		РеквизитыВида.Вставить("УчитыватьМестоХранения", Ложь);
		РеквизитыВида.Вставить("УчитыватьОтветственногоЗаХранение", Ложь);
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Объект.Содержание) Тогда
		Содержание = Объект.Содержание;
		HTMLТекст = HTMLТекст + СтрЗаменить(РаботаС_HTML.ЗаменитьСпецСимволыHTML(Содержание), Символы.ПС, "<br>");
		
		Если РеквизитыВида.УчитыватьСуммуДокумента 
			Или (Форма.Свойства_ИспользоватьСвойства И Форма.Свойства_ОписаниеДополнительныхРеквизитов.Количество() > 0) 
			Или (РеквизитыВида.ИспользоватьСрокИсполнения И ЗначениеЗаполнено(Объект.СрокИсполнения)) Тогда 
			HTMLТекст = HTMLТекст + "<p>";
		КонецЕсли;
	КонецЕсли;	
	
	Если РеквизитыВида.ИспользоватьСрокИсполнения И ЗначениеЗаполнено(Объект.СрокИсполнения) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Срок ответа:'"), Формат(Объект.СрокИсполнения, "ДЛФ=D"));
	КонецЕсли;
	
	Если РеквизитыВида.УчитыватьСуммуДокумента Тогда
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Сумма:'"), Формат(Объект.Сумма, "ЧДЦ=2; ЧН=0") + " " + 
			ОбщегоНазначения.ЗначениеРеквизитаОбъекта(Объект.Валюта, "Наименование"));
	КонецЕсли;
	
	Если Форма.Свойства_ИспользоватьСвойства Тогда 
		Для каждого Строка Из Форма.Свойства_ОписаниеДополнительныхРеквизитов Цикл
			Значение = Форма[Строка.ИмяРеквизитаЗначение];
			Если Не Строка.Удалено И ЗначениеЗаполнено(Значение) Тогда
				ДобавитьДопРеквизит(HTMLТекст, Значение, Строка);
			КонецЕсли;	
		КонецЦикла;	
	КонецЕсли;	
		
	HTMLТекст = HTMLТекст + "</td></tr>";	
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""3"">";
	
	Если ЗначениеЗаполнено(Объект.Подписал)
	 Или ЗначениеЗаполнено(Объект.Подготовил)
	 Или ЗначениеЗаполнено(Объект.Подразделение)
	Тогда 
		Если ЗначениеЗаполнено(Объект.Содержание) 
			Или РеквизитыВида.УчитыватьСуммуДокумента 
			Или (Форма.Свойства_ИспользоватьСвойства И Форма.Свойства_ОписаниеДополнительныхРеквизитов.Количество() > 0)  Тогда 
				HTMLТекст = HTMLТекст + "<p>";
		КонецЕсли;	
	КонецЕсли;	
		
	Если ЗначениеЗаполнено(Объект.Подписал) Тогда
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Подписал:'"), Объект.Подписал);
	КонецЕсли;	
		
	Если ЗначениеЗаполнено(Объект.Подготовил) Тогда
		ДобавитьПодпись(HTMLТекст, НСтр("ru = 'Подготовил:'"));
		ДобавитьЗначение(HTMLТекст, Объект.Подготовил, "");
		ДобавитьЗначение(HTMLТекст, " (" + Формат(Объект.ДатаСоздания, "ДЛФ=D") + ")", "");
		HTMLТекст = HTMLТекст + "<br>";
		
		КонтактнаяИнформация = ПолучитьКонтактнуюИнформацияОбъекта(Объект.Подготовил);
		
		Если ЗначениеЗаполнено(КонтактнаяИнформация.Телефон) Тогда
			ДобавитьРеквизит(HTMLТекст, "", КонтактнаяИнформация.Телефон, "696969");
		КонецЕсли;
		
		Если ЗначениеЗаполнено(КонтактнаяИнформация.Емайл) Тогда
			HTMLТекст = HTMLТекст + СтрШаблон(
					"<FONT color=#696969>%1</FONT>",
					НСтр("ru = 'E-mail:'") + " ");
			HTMLТекст = HTMLТекст + СтрШаблон(
				"<A color=#696969 href=v8doc:%1><FONT color=#696969>%2</FONT></A><BR>",
				"message"+КонтактнаяИнформация.Емайл,
				РаботаС_HTML.ЗаменитьСпецСимволыHTML(КонтактнаяИнформация.Емайл));
		КонецЕсли;
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Объект.Подразделение) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Подразделение:'"),  Объект.Подразделение);
	КонецЕсли;
	
	HTMLТекст = HTMLТекст + "</td></tr>";
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""3"">";
	
	ДелоТекст = Форма.ДелоТекст;
	КомуПереданДокумент = Форма.КомуПереданДокумент;
	ВестиУчетПоНоменклатуреДел = РеквизитыВида.ВестиУчетПоНоменклатуреДел;
	ИспользоватьНоменклатуруДел = ПолучитьФункциональнуюОпцию("ИспользоватьНоменклатуруДел");
	
	Если (ВестиУчетПоНоменклатуреДел И ЗначениеЗаполнено(Объект.НоменклатураДел))
		Или (ИспользоватьНоменклатуруДел И ЗначениеЗаполнено(ДелоТекст))
		Или ЗначениеЗаполнено(Объект.Ответственный)
		Или ЗначениеЗаполнено(Объект.ФормаДокумента)
		Или ЗначениеЗаполнено(КомуПереданДокумент) Тогда 
		HTMLТекст = HTMLТекст + "<p>";
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Объект.Ответственный) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Ответственный:'"),  Объект.Ответственный);
	КонецЕсли;
	
	Если ПолучитьФункциональнуюОпцию("РаздельныйУчетДокументов") И ЗначениеЗаполнено(Объект.ФормаДокумента) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Форма:'"),  Объект.ФормаДокумента);
	КонецЕсли;
	
	Если ИспользоватьНоменклатуруДел Тогда 
		Если ВестиУчетПоНоменклатуреДел И ЗначениеЗаполнено(Объект.НоменклатураДел) Тогда
			ДобавитьПодпись(HTMLТекст,  НСтр("ru = 'Номенклатура дел:'"));
			HTMLТекст = HTMLТекст + СтрШаблон(
				"<A href=v8doc:%1>%2</A><BR>",
				ПолучитьНавигационнуюСсылку(Объект.НоменклатураДел),
				Объект.НоменклатураДел);
		КонецЕсли;
		
		Если ЗначениеЗаполнено(ДелоТекст) Тогда
			ДобавитьПодпись(HTMLТекст,  НСтр("ru = 'Помещен в дело:'"));
			HTMLТекст = HTMLТекст + СтрШаблон(
				"<A href=v8doc:%1>%2</A><BR>",
				"dossier",
				РаботаС_HTML.ЗаменитьСпецСимволыHTML(ДелоТекст));
				
			СостояниеДела = СостояниеДела(Объект.Дело);
			Если ЗначениеЗаполнено(СостояниеДела) Тогда
				ДобавитьРеквизит(HTMLТекст, СостояниеДела.Состояние, СостояниеДела.ДатаСостояния);
			КонецЕсли;
			
			МестоХранения = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(Объект.Дело, "МестоХраненияДел");
			Если ЗначениеЗаполнено(МестоХранения) Тогда
				МестоХраненияТекст = ДелопроизводствоКлиентСервер.ПолучитьПолныйПутьКМестуХранения(МестоХранения,
					ПолучитьФункциональнуюОпцию("ИспользоватьСхемыПомещений"));
				ДобавитьПодпись(HTMLТекст,  НСтр("ru = 'Место хранения:'"));
				HTMLТекст = HTMLТекст + СтрШаблон(
					"<A href=v8doc:%1>%2</A><BR>",
					"storage",
					РаботаС_HTML.ЗаменитьСпецСимволыHTML(МестоХраненияТекст));
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
	
	Если РеквизитыХраненияИспользуются(
		РеквизитыВида.УчитыватьМестоХранения, Объект.МестоХранения, Объект.ФормаДокумента) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Место хранения:'"), Объект.МестоХранения);
	КонецЕсли;
	
	Если РеквизитыХраненияИспользуются(
		РеквизитыВида.УчитыватьОтветственногоЗаХранение, Объект.ОтветственныйЗаХранение, Объект.ФормаДокумента) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Отв. за хранение:'"), Объект.ОтветственныйЗаХранение);
	КонецЕсли;
	
	Если ЗначениеЗаполнено(КомуПереданДокумент) Тогда
		ДобавитьПодпись(HTMLТекст, НСтр("ru = 'Передан:'"));
		HTMLТекст = HTMLТекст + СтрШаблон(
			"<A href=v8doc:%1>%2</A><BR>",
			"holder",
			РаботаС_HTML.ЗаменитьСпецСимволыHTML(КомуПереданДокумент));
	КонецЕсли;	
	
	HTMLТекст = HTMLТекст + "</td></tr>";
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""3"">";
	
	Если ПолучитьФункциональнуюОпцию("ИспользоватьГрифыДоступа")
	 Или ПолучитьФункциональнуюОпцию("ИспользоватьВопросыДеятельности")
	 Или ПолучитьФункциональнуюОпцию("ИспользоватьСостоянияДокументов")
	Тогда 	
		HTMLТекст = HTMLТекст + "<p>";
	КонецЕсли;	
		
	Если ПолучитьФункциональнуюОпцию("ИспользоватьГрифыДоступа") Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Гриф:'"),  Объект.ГрифДоступа);
	КонецЕсли;
	
	Если ПолучитьФункциональнуюОпцию("ИспользоватьВопросыДеятельности") Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Вопрос:'"),  Объект.ВопросДеятельности);
	КонецЕсли;
	
	Если ПолучитьФункциональнуюОпцию("ВестиУчетПоПроектам") И ЗначениеЗаполнено(Объект.Проект) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Проект:'"),  Объект.Проект);
	КонецЕсли;
	
	Если ПолучитьФункциональнуюОпцию("ИспользоватьСостоянияДокументов") Тогда 
		ДобавитьПодпись(HTMLТекст, НСтр("ru = 'Состояние:'"));
		HTMLТекст = HTMLТекст + СтрШаблон(
			"<A href=v8doc:%1>%2</A><BR>",
			"status",
			Форма.СостояниеТекст);
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Объект.ВидДокумента) Тогда 
		
		Если РеквизитыВида.ИспользоватьЭтапыОбработкиДокумента Тогда 
			ПоследнийЭтап = Неопределено;
			ДатаПоследнегоЭтапа = '00010101';
			ПройденоЭтапов = 0; ВсегоЭтапов = Форма.ЭтапыОбработкиДокументов.Количество();
			Для Каждого Строка Из Форма.ЭтапыОбработкиДокументов Цикл
				Если Строка.Пройден Тогда 
					ПройденоЭтапов = ПройденоЭтапов + 1;
					
					Если  Строка.ДатаПрохождения >= ДатаПоследнегоЭтапа Тогда 
						ПоследнийЭтап = Строка.Этап;
						ДатаПоследнегоЭтапа = Строка.ДатаПрохождения;
					КонецЕсли;
				КонецЕсли;
			КонецЦикла;
			
			Если ЗначениеЗаполнено(ПоследнийЭтап) Тогда 
				ДобавитьПодпись(HTMLТекст, НСтр("ru = 'Этапы:'"));
				HTMLТекст = HTMLТекст + СтрШаблон(
					"<A href=v8doc:%1>Пройдено %2 из %3</A>",
					"phase",
					ПройденоЭтапов,
					ВсегоЭтапов);
				ДобавитьПодпись(HTMLТекст, " " + СтрШаблон(
					НСтр("ru = '(последний ""%1"" %2)'"), 
					РаботаС_HTML.ЗаменитьСпецСимволыHTML(Строка(ПоследнийЭтап)), Формат(ДатаПоследнегоЭтапа, "ДЛФ=D")));
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Объект.Комментарий) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Комментарий:'"),  Объект.Комментарий);
	КонецЕсли;
	
	HTMLТекст = HTMLТекст + "</td></tr>";	
	HTMLТекст = HTMLТекст + "</table>";
	
	HTMLТекст = HTMLТекст + "</body></html>";
	
	ОбзорОбъектовКлиентСервер.УдалитьВредоносныйКодИзТекста(HTMLТекст);
	
	Возврат HTMLТекст;
	
КонецФункции	

// Возвращает текст HTML для показа обзора входящего документа
Функция ПолучитьОбзорВходящегоДокумента(Форма) Экспорт 
	
	HTMLТекст = ОбзорДокументаПереопределяемый.ПолучитьОбзорВходящегоДокумента(Форма);
	Если ЗначениеЗаполнено(HTMLТекст) Тогда 
		Возврат HTMLТекст;
	КонецЕсли;
	
	Объект = Форма.Объект;
	Организация = Объект.Организация;

	// Формируем основное представление документа	
	HTMLТекст = "<html>
	|<head>
	|<style type=""text/css"">
	|	body {
	|		overflow:    auto;
	|		margin-top:  6px;
	|		margin-left: 10px;
	|		margin-bottom: 0px;
	|		font-family: Arial, sans-serif;
	|		font-size:   10pt;}
	|	table {
	|		width:       100%;  
	|		font-family: Arial, sans-serif;
	|		font-size:   10pt;}
	|	td {vertical-align: top;}
	| 	a:link {
	|		color: #006699; text-decoration: none;}
	|	a:visited {
	|		color: #006699; text-decoration: none;}
	|	a:hover {
	|		color: #006699; text-decoration: underline;}
	|	p {
	|		margin-top: 7px;}
	|</style>
	|<body>";
	
	HTMLТекст = HTMLТекст + "<table>";
	HTMLТекст = HTMLТекст + "<tr>";
	
	HTMLТекст = HTMLТекст + "<td width=""40%"" align=center >";
	ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'От кого:'"), "");
	HTMLТекст = HTMLТекст + "<p>";
	ДобавитьРеквизит(HTMLТекст, "", Объект.Отправитель);
	
	Если ЗначениеЗаполнено(Объект.ВидДокумента) Тогда
		HTMLТекст = HTMLТекст + "<p>";
		HTMLТекст = HTMLТекст + СтрШаблон(
			"<A href=v8doc:%1>%2</A>",
			ПолучитьНавигационнуюСсылку(Объект.ВидДокумента),
			ВРег(РаботаС_HTML.ЗаменитьСпецСимволыHTML((Строка(Объект.ВидДокумента)))));
		HTMLТекст = HTMLТекст + "<p>";
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Объект.ИсходящаяДата) И ЗначениеЗаполнено(Объект.ИсходящийНомер) Тогда 
		ДобавитьРеквизит(HTMLТекст, "", Формат(Объект.ИсходящаяДата, "ДЛФ=D") 
		+ " № " +  Объект.ИсходящийНомер);
	Иначе
		ДобавитьРеквизит(HTMLТекст, "________ №________", "");
	КонецЕсли;
	HTMLТекст = HTMLТекст + "<p>";
	Если ЗначениеЗаполнено(Форма.ВОтветНаСтрока) И Лев(Форма.ВОтветНаСтрока, 1) = "№" Тогда 
		ДобавитьПодпись(HTMLТекст, НСтр("ru = 'На'") + " ");
		HTMLТекст = HTMLТекст + СтрШаблон(
			"<A href=v8doc:%1>%2</A><BR>",
			ПолучитьНавигационнуюСсылку(Форма.ВОтветНа),
			Форма.ВОтветНаСтрока);
	Иначе
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'На №______ от ______'"), "");
	КонецЕсли;
	HTMLТекст = HTMLТекст + "</td>";	
	
	HTMLТекст = HTMLТекст + "<td>";
	HTMLТекст = HTMLТекст + "</td>";
	
	HTMLТекст = HTMLТекст + "<td width=""50%"">";
	
	ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Кому:'"), "");
	HTMLТекст = HTMLТекст + "<p>";
	
	ДобавитьРеквизит(HTMLТекст, "", Организация);
	
	Если ЗначениеЗаполнено(Объект.Адресат) Тогда
		HTMLТекст = HTMLТекст + "<p>";
		ДобавитьВТекстДанныеКонтактногоЛица(Объект.Адресат, HTMLТекст, "");
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Объект.Подразделение) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Подразделение:'"),  Объект.Подразделение);
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Объект.ДатаРегистрации) И ЗначениеЗаполнено(Объект.РегистрационныйНомер) Тогда 
		HTMLТекст = HTMLТекст + "<p>";
		ДобавитьРеквизит(HTMLТекст, "", СтрШаблон(
			НСтр("ru = 'Рег. № %1 от %2'"),
			Объект.РегистрационныйНомер,
			Формат(Объект.ДатаРегистрации, "ДЛФ=D")));
	КонецЕсли;	
	
	HTMLТекст = HTMLТекст + "</td>";
	HTMLТекст = HTMLТекст + "</tr>";
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""3"">";
	
	HTMLТекст = HTMLТекст + "<p>";
	Заголовок = Объект.Заголовок;
	HTMLТекст = HTMLТекст + СтрШаблон(
		"<B>%1</B>",
		РаботаС_HTML.ЗаменитьСпецСимволыHTML(Заголовок));
		
	Если ЗначениеЗаполнено(Объект.ВидДокумента) Тогда 
		РеквизитыВида = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(Объект.ВидДокумента,
			"УчитыватьСуммуДокумента, ИспользоватьСрокИсполнения, ВестиУчетПоНоменклатуреДел,
			|ИспользоватьЭтапыОбработкиДокумента, УчитыватьМестоХранения, УчитыватьОтветственногоЗаХранение,
			|КонтролироватьНаличиеОригинала");
	Иначе 
		РеквизитыВида = Новый Структура;
		РеквизитыВида.Вставить("УчитыватьСуммуДокумента", Ложь);
		РеквизитыВида.Вставить("ИспользоватьСрокИсполнения", Ложь);
		РеквизитыВида.Вставить("ВестиУчетПоНоменклатуреДел", Ложь);
		РеквизитыВида.Вставить("ИспользоватьЭтапыОбработкиДокумента", Ложь);
		РеквизитыВида.Вставить("УчитыватьМестоХранения", Ложь);
		РеквизитыВида.Вставить("УчитыватьОтветственногоЗаХранение", Ложь);
		РеквизитыВида.Вставить("КонтролироватьНаличиеОригинала", Ложь);
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Объект.Содержание)
		Или ЗначениеЗаполнено(Объект.СрокИсполнения)  
		Или  РеквизитыВида.УчитыватьСуммуДокумента 
		Или (Форма.Свойства_ИспользоватьСвойства И Форма.Свойства_ОписаниеДополнительныхРеквизитов.Количество() > 0) Тогда 
		HTMLТекст = HTMLТекст + "<p>";
	КонецЕсли;
		
	Если ЗначениеЗаполнено(Объект.Содержание) Тогда
		Содержание = Объект.Содержание;
		HTMLТекст = HTMLТекст + СтрЗаменить(РаботаС_HTML.ЗаменитьСпецСимволыHTML(Содержание), Символы.ПС, "<br>");
		HTMLТекст = HTMLТекст + "<br>";
		
	КонецЕсли;
	
	Если РеквизитыВида.ИспользоватьСрокИсполнения И ЗначениеЗаполнено(Объект.СрокИсполнения) Тогда 
		Состояние = Делопроизводство.ПолучитьСостояниеДокумента(Объект.Ссылка, "СостояниеИсполнение");
		Если Объект.СрокИсполнения < НачалоДня(ТекущаяДатаСеанса()) И Состояние <> Перечисления.СостоянияДокументов.Исполнен Тогда 
			ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Срок исполнения:'"), Формат(Объект.СрокИсполнения, "ДЛФ=D"), "B22222");
		Иначе
			ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Срок исполнения:'"), Формат(Объект.СрокИсполнения, "ДЛФ=D"));
		КонецЕсли;
	КонецЕсли;
	
	Если РеквизитыВида.УчитыватьСуммуДокумента Или
		(Форма.Свойства_ИспользоватьСвойства И Форма.Свойства_ОписаниеДополнительныхРеквизитов.Количество() > 0) Тогда 
		HTMLТекст = HTMLТекст + "<p>";
	КонецЕсли;
	
	Если РеквизитыВида.УчитыватьСуммуДокумента Тогда
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Сумма:'"), Формат(Объект.Сумма, "ЧДЦ=2; ЧН=0") + " " + 
			ОбщегоНазначения.ЗначениеРеквизитаОбъекта(Объект.Валюта, "Наименование"));
	КонецЕсли;
	
	Если Форма.Свойства_ИспользоватьСвойства Тогда 
		Для каждого Строка Из Форма.Свойства_ОписаниеДополнительныхРеквизитов Цикл
			Значение = Форма[Строка.ИмяРеквизитаЗначение];
			Если Не Строка.Удалено И ЗначениеЗаполнено(Значение) Тогда
				ДобавитьДопРеквизит(HTMLТекст, Значение, Строка);
			КонецЕсли;	
		КонецЦикла;	
	КонецЕсли;	
		
	HTMLТекст = HTMLТекст + "</td></tr>";	
	
	Если ЗначениеЗаполнено(Объект.Подписал) Тогда 
		
		HTMLТекст = HTMLТекст + "<tr>";
		HTMLТекст = HTMLТекст + "<td colspan=""3"">";
		
		Если ЗначениеЗаполнено(Объект.Содержание) 
			Или РеквизитыВида.УчитыватьСуммуДокумента 
			Или ЗначениеЗаполнено(Объект.СрокИсполнения)
			Или (Форма.Свойства_ИспользоватьСвойства И Форма.Свойства_ОписаниеДополнительныхРеквизитов.Количество() > 0)  Тогда 
			HTMLТекст = HTMLТекст + "<p>";
		КонецЕсли;
		
		Если ЗначениеЗаполнено(Объект.Подписал) Тогда
			ДобавитьВТекстДанныеКонтактногоЛица(Объект.Подписал, HTMLТекст, НСтр("ru = 'Подписал:'"));
		КонецЕсли;	
		
		HTMLТекст = HTMLТекст + "</td></tr>";
		
	КонецЕсли;	
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""3"">";
	
	ДелоТекст = Форма.ДелоТекст;
	КомуПереданДокумент = Форма.КомуПереданДокумент;
	ВестиУчетПоНоменклатуреДел = РеквизитыВида.ВестиУчетПоНоменклатуреДел;
	ИспользоватьМестаХранения = ПолучитьФункциональнуюОпцию("ИспользоватьМестаХранения");
	ИспользоватьНоменклатуруДел = ПолучитьФункциональнуюОпцию("ИспользоватьНоменклатуруДел");
	
	МестоХраненияДокументаИспользуется = РеквизитыХраненияИспользуются(
		РеквизитыВида.УчитыватьМестоХранения, Объект.МестоХранения, Объект.ФормаДокумента);
	
	Если (ВестиУчетПоНоменклатуреДел И ЗначениеЗаполнено(Объект.НоменклатураДел))
		Или (ИспользоватьНоменклатуруДел И ЗначениеЗаполнено(ДелоТекст))
		Или ЗначениеЗаполнено(Объект.Ответственный)
		Или ЗначениеЗаполнено(Объект.ФормаДокумента)
		Или ИспользоватьМестаХранения
		Или ЗначениеЗаполнено(КомуПереданДокумент) Тогда 
		HTMLТекст = HTMLТекст + "<p>";
		
		Если ЗначениеЗаполнено(Объект.Ответственный) Тогда 
			ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Ответственный:'"),  Объект.Ответственный);
		КонецЕсли;
		
		Если РеквизитыВида.КонтролироватьНаличиеОригинала И ЗначениеЗаполнено(Форма.ОригиналПолученТекст) Тогда 
			Если Не Форма.ОригиналПолучен И ЗначениеЗаполнено(Объект.РегистрационныйНомер) Тогда 
				ДобавитьПодпись(HTMLТекст, НСтр("ru = 'Оригинал:'"));
				HTMLТекст = HTMLТекст + СтрШаблон(
					"<A href=v8doc:%1><FONT color=#%2>%3</FONT></A><BR>",
					"Original",
					"B22222",
					РаботаС_HTML.ЗаменитьСпецСимволыHTML(Форма.ОригиналПолученТекст));
			Иначе 
				ДобавитьПодпись(HTMLТекст, НСтр("ru = 'Оригинал:'"));
				HTMLТекст = HTMLТекст + СтрШаблон(
					"<A href=v8doc:%1>%2</A><BR>",
					"Original",
					РаботаС_HTML.ЗаменитьСпецСимволыHTML(Форма.ОригиналПолученТекст));
			КонецЕсли;
		КонецЕсли;
		
		Если ПолучитьФункциональнуюОпцию("РаздельныйУчетДокументов") И ЗначениеЗаполнено(Объект.ФормаДокумента) Тогда 
			ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Форма:'"),  Объект.ФормаДокумента);
		КонецЕсли;
		
		Если ИспользоватьНоменклатуруДел Тогда 
			Если ВестиУчетПоНоменклатуреДел И ЗначениеЗаполнено(Объект.НоменклатураДел) Тогда
				ДобавитьПодпись(HTMLТекст,  НСтр("ru = 'Номенклатура дел:'"));
				HTMLТекст = HTMLТекст + СтрШаблон(
					"<A href=v8doc:%1>%2</A><BR>",
					ПолучитьНавигационнуюСсылку(Объект.НоменклатураДел),
					Объект.НоменклатураДел);
			КонецЕсли;
			
			Если ЗначениеЗаполнено(ДелоТекст) Тогда
				ДобавитьПодпись(HTMLТекст,  НСтр("ru = 'Помещен в дело:'"));
				HTMLТекст = HTMLТекст + СтрШаблон(
				"<A href=v8doc:%1>%2</A><BR>",
				"dossier",
				РаботаС_HTML.ЗаменитьСпецСимволыHTML(ДелоТекст));
				
				СостояниеДела = СостояниеДела(Объект.Дело);
				Если ЗначениеЗаполнено(СостояниеДела) Тогда
					ДобавитьРеквизит(HTMLТекст, СостояниеДела.Состояние, СостояниеДела.ДатаСостояния);
				КонецЕсли;
				
				МестоХранения = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(Объект.Дело, "МестоХраненияДел");
				Если ЗначениеЗаполнено(МестоХранения) Тогда
					МестоХраненияТекст = ДелопроизводствоКлиентСервер.ПолучитьПолныйПутьКМестуХранения(МестоХранения,
						ПолучитьФункциональнуюОпцию("ИспользоватьСхемыПомещений"));
					Если МестоХраненияДокументаИспользуется Тогда
						ДобавитьПодпись(HTMLТекст,  НСтр("ru = 'Место хранения дела:'"));
					Иначе
						ДобавитьПодпись(HTMLТекст,  НСтр("ru = 'Место хранения:'"));
					КонецЕсли;
					HTMLТекст = HTMLТекст + СтрШаблон(
						"<A href=v8doc:%1>%2</A><BR>",
						"storage",
						РаботаС_HTML.ЗаменитьСпецСимволыHTML(МестоХраненияТекст));
				КонецЕсли;
			КонецЕсли;
		КонецЕсли;
		
		Если МестоХраненияДокументаИспользуется Тогда 
			ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Место хранения:'"), Объект.МестоХранения);
		КонецЕсли;
		
		Если РеквизитыХраненияИспользуются(
			РеквизитыВида.УчитыватьОтветственногоЗаХранение, Объект.ОтветственныйЗаХранение, Объект.ФормаДокумента) Тогда 
			ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Отв. за хранение:'"), Объект.ОтветственныйЗаХранение);
		КонецЕсли;
		
		Если ЗначениеЗаполнено(КомуПереданДокумент) Тогда
			ДобавитьПодпись(HTMLТекст, НСтр("ru = 'Передан:'"));
			HTMLТекст = HTMLТекст + СтрШаблон(
			"<A href=v8doc:%1>%2</A><BR>",
			"holder",
			РаботаС_HTML.ЗаменитьСпецСимволыHTML(КомуПереданДокумент));
		КонецЕсли;	
		
		HTMLТекст = HTMLТекст + "</td></tr>";
		
	КонецЕсли;
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""3"">";
	
	Если ПолучитьФункциональнуюОпцию("ИспользоватьГрифыДоступа")
	 Или ПолучитьФункциональнуюОпцию("ИспользоватьВопросыДеятельности")
	 Или ПолучитьФункциональнуюОпцию("ИспользоватьСостоянияДокументов")
	 Или (ПолучитьФункциональнуюОпцию("ВестиУчетПоПроектам") И ЗначениеЗаполнено(Объект.Проект))
	Тогда 	
		HTMLТекст = HTMLТекст + "<p>";
	КонецЕсли;	
		
	Если ПолучитьФункциональнуюОпцию("ИспользоватьГрифыДоступа") Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Гриф:'"),  Объект.ГрифДоступа);
	КонецЕсли;
	
	Если ПолучитьФункциональнуюОпцию("ИспользоватьВопросыДеятельности") Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Вопрос:'"),  Объект.ВопросДеятельности);
	КонецЕсли;
	
	Если ПолучитьФункциональнуюОпцию("ВестиУчетПоПроектам") И ЗначениеЗаполнено(Объект.Проект) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Проект:'"),  Объект.Проект);
	КонецЕсли;
	
	Если ПолучитьФункциональнуюОпцию("ИспользоватьСостоянияДокументов") Тогда 
		ДобавитьПодпись(HTMLТекст, НСтр("ru = 'Состояние:'"));
		HTMLТекст = HTMLТекст + СтрШаблон(
			"<A href=v8doc:%1>%2</A><BR>",
			"status",
			Форма.СостояниеТекст);
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Объект.ВидДокумента) Тогда 
		
		Если РеквизитыВида.ИспользоватьЭтапыОбработкиДокумента Тогда 
			ПоследнийЭтап = Неопределено;
			ДатаПоследнегоЭтапа = '00010101';
			ПройденоЭтапов = 0; ВсегоЭтапов = Форма.ЭтапыОбработкиДокументов.Количество();
			Для Каждого Строка Из Форма.ЭтапыОбработкиДокументов Цикл
				Если Строка.Пройден Тогда 
					ПройденоЭтапов = ПройденоЭтапов + 1;
					
					Если  Строка.ДатаПрохождения >= ДатаПоследнегоЭтапа Тогда 
						ПоследнийЭтап = Строка.Этап;
						ДатаПоследнегоЭтапа = Строка.ДатаПрохождения;
					КонецЕсли;
				КонецЕсли;
			КонецЦикла;
			
			Если ЗначениеЗаполнено(ПоследнийЭтап) Тогда 
				ДобавитьПодпись(HTMLТекст, НСтр("ru = 'Этапы:'"));
				HTMLТекст = HTMLТекст + СтрШаблон(
					"<A href=v8doc:%1>Пройдено %2 из %3</A>",
					"phase",
					ПройденоЭтапов,
					ВсегоЭтапов);
				ДобавитьПодпись(HTMLТекст, " " + СтрШаблон(
					НСтр("ru = '(последний ""%1"" %2)'"), 
					РаботаС_HTML.ЗаменитьСпецСимволыHTML(Строка(ПоследнийЭтап)), Формат(ДатаПоследнегоЭтапа, "ДЛФ=D")));
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Объект.Комментарий) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Комментарий:'"),  Объект.Комментарий);
	КонецЕсли;
	
	HTMLТекст = HTMLТекст + "</td></tr>";	
	HTMLТекст = HTMLТекст + "</table>";
	
	HTMLТекст = HTMLТекст + "</body></html>";
	
	ОбзорОбъектовКлиентСервер.УдалитьВредоносныйКодИзТекста(HTMLТекст);
	
	Возврат HTMLТекст;
	
КонецФункции	

Функция ПолучитьОбзорВнутреннегоДокументаБезКонтрагента(Форма)

	Объект = Форма.Объект;
	Организация = Объект.Организация;
	
	Если ЗначениеЗаполнено(Объект.ВидДокумента) Тогда 
		РеквизитыВида = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(Объект.ВидДокумента,
			"УчитыватьСуммуДокумента, ИспользоватьСрокИсполнения, ВестиУчетПоНоменклатуреДел, УчитыватьСрокДействия,
			|УчитыватьНедействующиеДокументы, ВестиУчетТоваровИУслуг, ВестиУчетПоСтатьямДДС, ВестиУчетПоОрганизациям,
			|ИспользоватьЭтапыОбработкиДокумента, ИспользоватьПодписание, ИспользоватьУтверждение, ВестиУчетСторон,
			|УчитыватьМестоХранения, УчитыватьОтветственногоЗаХранение, КонтролироватьНаличиеОригинала");
	Иначе 
		РеквизитыВида = Новый Структура;
		РеквизитыВида.Вставить("УчитыватьСуммуДокумента", Ложь);
		РеквизитыВида.Вставить("ВестиУчетТоваровИУслуг", Ложь);
		РеквизитыВида.Вставить("ИспользоватьСрокИсполнения", Ложь);
		РеквизитыВида.Вставить("ВестиУчетПоНоменклатуреДел", Ложь);
		РеквизитыВида.Вставить("УчитыватьСрокДействия", Ложь);
		РеквизитыВида.Вставить("УчитыватьНедействующиеДокументы", Ложь);
		РеквизитыВида.Вставить("ВестиУчетПоСтатьямДДС", Ложь);
		РеквизитыВида.Вставить("ИспользоватьЭтапыОбработкиДокумента", Ложь);
		РеквизитыВида.Вставить("ВестиУчетПоОрганизациям", Ложь);
		РеквизитыВида.Вставить("ИспользоватьПодписание", Ложь);
		РеквизитыВида.Вставить("ИспользоватьУтверждение", Ложь);
		РеквизитыВида.Вставить("ВестиУчетСторон", Ложь);
		РеквизитыВида.Вставить("УчитыватьМестоХранения", Ложь);
		РеквизитыВида.Вставить("УчитыватьОтветственногоЗаХранение", Ложь);
		РеквизитыВида.Вставить("КонтролироватьНаличиеОригинала", Ложь);
	КонецЕсли;
	
	// Формируем основное представление документа	
	HTMLТекст = "<html>
	|<head>
	|<style type=""text/css"">
	|	body {
	|		overflow:    auto;
	|		margin-top:  6px; 		 
	|		margin-left: 10px;
	|		margin-bottom: 0px;
	|		font-family: Arial, sans-serif;
	|		font-size:   10pt;}
	|	table {
	|		width:       100%; 
	|		font-family: Arial, sans-serif;
	|		font-size:   10pt;}
	|	td {vertical-align: top;}
	| 	a:link {
	|		color: #006699; text-decoration: none;}
	|	a:visited {
	|		color: #006699; text-decoration: none;}
	|	a:hover {
	|		color: #006699; text-decoration: underline;}
	|	p {
	|		margin-top: 7px;}
	|</style>
	|<body>";
	
	HTMLТекст = HTMLТекст + "<table>";
	
	Если ЗначениеЗаполнено(Организация)
		И (РеквизитыВида.ВестиУчетПоОрганизациям
			Или Не ПолучитьФункциональнуюОпцию("ИспользоватьУчетПоОрганизациям")) Тогда
		HTMLТекст = HTMLТекст + "<tr>";
		HTMLТекст = HTMLТекст + "<td colspan=""2"" align=""center"">";
		ДобавитьРеквизит(HTMLТекст, "", Организация);
		HTMLТекст = HTMLТекст + "</td>";
		HTMLТекст = HTMLТекст + "</tr>";
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Объект.ВидДокумента) Тогда 
		HTMLТекст = HTMLТекст + "<tr>";
	    HTMLТекст = HTMLТекст + "<td colspan=""2"" align=""center"">";
		HTMLТекст = HTMLТекст + "<p>";
		HTMLТекст = HTMLТекст + СтрШаблон(
			"<A href=v8doc:%1>%2</A>",
			ПолучитьНавигационнуюСсылку(Объект.ВидДокумента),
			ВРег(РаботаС_HTML.ЗаменитьСпецСимволыHTML((Строка(Объект.ВидДокумента)))));
		HTMLТекст = HTMLТекст + "</td>";
		HTMLТекст = HTMLТекст + "</tr>";
	КонецЕсли;
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td width=""70%"">";
	Если ЗначениеЗаполнено(Объект.ДатаРегистрации) Тогда 
		ДобавитьРеквизит(HTMLТекст, "", Формат(Объект.ДатаРегистрации, "ДЛФ=D"));
	Иначе
		ДобавитьРеквизит(HTMLТекст, "____________", "");
	КонецЕсли;
	HTMLТекст = HTMLТекст + "</td>";
	
    HTMLТекст = HTMLТекст + "<td>";
	Если ЗначениеЗаполнено(Объект.РегистрационныйНомер) Тогда 
		ДобавитьРеквизит(HTMLТекст, "№ ", Объект.РегистрационныйНомер);
	Иначе
		ДобавитьРеквизит(HTMLТекст, "№___________", "");
	КонецЕсли;	
	HTMLТекст = HTMLТекст + "</td>";
	HTMLТекст = HTMLТекст + "</tr>";
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""2"">";
	
	HTMLТекст = HTMLТекст + "<p>";
	Заголовок = Объект.Заголовок;
	HTMLТекст = HTMLТекст + СтрШаблон(
		"<B>%1</B>",
		РаботаС_HTML.ЗаменитьСпецСимволыHTML(Заголовок));
	HTMLТекст = HTMLТекст + "<p>";
		
	HTMLТекст = HTMLТекст + "<p>";	
	Если ЗначениеЗаполнено(Объект.Содержание) Тогда
		Содержание = Объект.Содержание;
		HTMLТекст = HTMLТекст + СтрЗаменить(РаботаС_HTML.ЗаменитьСпецСимволыHTML(Содержание), Символы.ПС, "<br>");
		HTMLТекст = HTMLТекст + "<p>";
	КонецЕсли;
	
	Если РеквизитыВида.ИспользоватьСрокИсполнения И ЗначениеЗаполнено(Объект.СрокИсполнения) Тогда 
		Состояние = Делопроизводство.ПолучитьСостояниеДокумента(Объект.Ссылка, "СостояниеИсполнение");
		Если Объект.СрокИсполнения < НачалоДня(ТекущаяДатаСеанса()) И Состояние <> Перечисления.СостоянияДокументов.Исполнен Тогда 
			ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Срок исполнения:'"), Формат(Объект.СрокИсполнения, "ДЛФ=D"), "B22222");
		Иначе
			ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Срок исполнения:'"), Формат(Объект.СрокИсполнения, "ДЛФ=D"));
		КонецЕсли;
	КонецЕсли;
	
	// Сумма и статьи ДДС.
	Если РеквизитыВида.УчитыватьСуммуДокумента Тогда
		Валюта = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(Объект.Валюта, "Наименование");
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Сумма:'"), Формат(Объект.Сумма, "ЧДЦ=2; ЧН=0") + " " + 
			Валюта);
			
		Если Форма.УчитыватьНДС Тогда 
			ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Сумма НДС:'"), Формат(Объект.СуммаНДС, "ЧДЦ=2; ЧН=0") + " " + 
				Валюта);
		КонецЕсли;
		
		Если РеквизитыВида.ВестиУчетТоваровИУслуг И Объект.Товары.Количество() > 0 Тогда
			КоличествоПозиций = Объект.Товары.Количество();
			ДобавитьПодпись(HTMLТекст, НСтр("ru = 'Товары и услуги:'"));
			HTMLТекст = HTMLТекст + СтрШаблон(
				"<A href=%1>%2</A><BR>",
				"goods?ref=" + Строка(Объект.Ссылка.УникальныйИдентификатор()),
				Формат(КоличествоПозиций, "ЧГ=") + " "
				+ ПользователиСлужебныйКлиентСервер.ПредметЦелогоЧисла(КоличествоПозиций,
					"Л = ru_RU", НСтр("ru = 'позиция,позиции,позиций,,,,,,0'")));
		КонецЕсли;
		
		Если РеквизитыВида.ВестиУчетПоСтатьямДДС Тогда
			СтатьиДДС = Форма.СтатьиДвиженияДенежныхСредств;
			КоличествоСтатей = СтатьиДДС.Количество();
			Если КоличествоСтатей = 1 Тогда
				ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Статья ДДС:'"), 
					СтатьиДДС[0].СтатьяДвиженияДенежныхСредств);
			ИначеЕсли КоличествоСтатей > 1 Тогда
				ДобавитьПодпись(HTMLТекст, НСтр("ru = 'Статьи ДДС:'"));
				Разделитель = "";
				Для каждого Строка из СтатьиДДС Цикл
					HTMLТекст = HTMLТекст + Разделитель;
					ДобавитьЗначение(HTMLТекст, Строка.СтатьяДвиженияДенежныхСредств, "");
					Разделитель = "; ";
				КонецЦикла;
				HTMLТекст = HTMLТекст + "<br>";
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
	
	Если РеквизитыВида.УчитыватьСрокДействия Тогда
		СрокДействияСтрока = Форма.СрокДействияСтрока;
		ДобавитьПодпись(HTMLТекст, НСтр("ru = 'Срок действия:'"));
		
		HTMLТекст = HTMLТекст + СтрШаблон(
			"<A href=v8doc:%1>%2</A><BR>",
			"period",
			РаботаС_HTML.ЗаменитьСпецСимволыHTML(?(ЗначениеЗаполнено(СрокДействияСтрока),
				СрокДействияСтрока, НСтр("ru = 'не указан'"))));
	КонецЕсли;
	
	Если РеквизитыВида.УчитыватьНедействующиеДокументы Тогда
		Если Объект.НеДействует Тогда
			HTMLТекст = HTMLТекст + СтрШаблон(
				"<b><FONT color=#696969>%1</FONT></b><br>",
				НСтр("ru = 'Не действует'")) ;
		КонецЕсли;
	КонецЕсли;
		
	Если Форма.Свойства_ИспользоватьСвойства Тогда 
		Для каждого Строка Из Форма.Свойства_ОписаниеДополнительныхРеквизитов Цикл
			Значение = Форма[Строка.ИмяРеквизитаЗначение];
			Если Не Строка.Удалено И ЗначениеЗаполнено(Значение) Тогда
				ДобавитьДопРеквизит(HTMLТекст, Значение, Строка);
			КонецЕсли;	
		КонецЦикла;	
	КонецЕсли;	
		
	HTMLТекст = HTMLТекст + "</td></tr>";	
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td>";
	
	HTMLТекст = HTMLТекст + "<p>";
		
	Если ЗначениеЗаполнено(Объект.Подготовил) Тогда
		ДобавитьПодпись(HTMLТекст, НСтр("ru = 'Подготовил:'"));
		ДобавитьЗначение(HTMLТекст, Объект.Подготовил, "");
		ДобавитьЗначение(HTMLТекст, " (" + Формат(Объект.ДатаСоздания, "ДЛФ=D") + ")", "");
		HTMLТекст = HTMLТекст + "<br>";
		
		КонтактнаяИнформация = ПолучитьКонтактнуюИнформацияОбъекта(Объект.Подготовил);
		
		Если ЗначениеЗаполнено(КонтактнаяИнформация.Телефон) Тогда
			ДобавитьРеквизит(HTMLТекст, "", КонтактнаяИнформация.Телефон, "696969");
		КонецЕсли;
		
		Если ЗначениеЗаполнено(КонтактнаяИнформация.Емайл) Тогда
			HTMLТекст = HTMLТекст + СтрШаблон(
				"<FONT color=#696969>%1</FONT>",
				НСтр("ru = 'E-mail:'") + " ");
			HTMLТекст = HTMLТекст + СтрШаблон(
				"<A color=#696969 href=v8doc:%1><FONT color=#696969>%2</FONT></A><BR>",
				"message"+КонтактнаяИнформация.Емайл,
				РаботаС_HTML.ЗаменитьСпецСимволыHTML(КонтактнаяИнформация.Емайл));
		КонецЕсли;
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Объект.Подразделение) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Подразделение:'"),  Объект.Подразделение);
	КонецЕсли;
	
	HTMLТекст = HTMLТекст + "</td>";
	HTMLТекст = HTMLТекст + "</tr>";
	
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""2"">";
	
	HTMLТекст = HTMLТекст + "<p>";
	
	Если ЗначениеЗаполнено(Объект.Ответственный) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Ответственный:'"),  Объект.Ответственный);
	КонецЕсли;
	
	Если РеквизитыВида.КонтролироватьНаличиеОригинала И ЗначениеЗаполнено(Форма.ОригиналПолученТекст) Тогда 
		Если Не Форма.ОригиналПолучен И ЗначениеЗаполнено(Объект.РегистрационныйНомер) Тогда 
			ДобавитьПодпись(HTMLТекст, НСтр("ru = 'Оригинал:'"));
			HTMLТекст = HTMLТекст + СтрШаблон(
				"<A href=v8doc:%1><FONT color=#%2>%3</FONT></A><BR>",
				"Original",
				"B22222",
				РаботаС_HTML.ЗаменитьСпецСимволыHTML(Форма.ОригиналПолученТекст));
		Иначе 
			ДобавитьПодпись(HTMLТекст, НСтр("ru = 'Оригинал:'"));
			HTMLТекст = HTMLТекст + СтрШаблон(
				"<A href=v8doc:%1>%2</A><BR>",
				"Original",
				РаботаС_HTML.ЗаменитьСпецСимволыHTML(Форма.ОригиналПолученТекст));
		КонецЕсли;
	КонецЕсли;
	
	Если ПолучитьФункциональнуюОпцию("РаздельныйУчетДокументов") И ЗначениеЗаполнено(Объект.ФормаДокумента) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Форма:'"), Объект.ФормаДокумента);
	КонецЕсли;
	
	МестоХраненияДокументаИспользуется = РеквизитыХраненияИспользуются(
		РеквизитыВида.УчитыватьМестоХранения, Объект.МестоХранения, Объект.ФормаДокумента);
	
	Если ПолучитьФункциональнуюОпцию("ИспользоватьНоменклатуруДел") Тогда 
		Если РеквизитыВида.ВестиУчетПоНоменклатуреДел И ЗначениеЗаполнено(Объект.НоменклатураДел) Тогда
			ДобавитьПодпись(HTMLТекст,  НСтр("ru = 'Номенклатура дел:'"));
			HTMLТекст = HTMLТекст + СтрШаблон(
				"<A href=v8doc:%1>%2</A><BR>",
				ПолучитьНавигационнуюСсылку(Объект.НоменклатураДел),
				Объект.НоменклатураДел);
		КонецЕсли;
		
		ДелоТекст = Форма.ДелоТекст;
		Если ЗначениеЗаполнено(ДелоТекст) Тогда
			ДобавитьПодпись(HTMLТекст,  НСтр("ru = 'Помещен в дело:'"));
			HTMLТекст = HTMLТекст + СтрШаблон(
				"<A href=v8doc:%1>%2</A><BR>",
				"dossier",
				РаботаС_HTML.ЗаменитьСпецСимволыHTML(ДелоТекст));
				
			СостояниеДела = СостояниеДела(Объект.Дело);
			Если ЗначениеЗаполнено(СостояниеДела) Тогда
				ДобавитьРеквизит(HTMLТекст, СостояниеДела.Состояние, СостояниеДела.ДатаСостояния);
			КонецЕсли;
			
			МестоХранения = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(Объект.Дело, "МестоХраненияДел");
			Если ЗначениеЗаполнено(МестоХранения) Тогда
				МестоХраненияТекст = ДелопроизводствоКлиентСервер.ПолучитьПолныйПутьКМестуХранения(МестоХранения,
					ПолучитьФункциональнуюОпцию("ИспользоватьСхемыПомещений"));
				Если МестоХраненияДокументаИспользуется Тогда
					ДобавитьПодпись(HTMLТекст,  НСтр("ru = 'Место хранения дела:'"));
				Иначе
					ДобавитьПодпись(HTMLТекст,  НСтр("ru = 'Место хранения:'"));
				КонецЕсли;
				HTMLТекст = HTMLТекст + СтрШаблон(
					"<A href=v8doc:%1>%2</A><BR>",
					"storage",
					РаботаС_HTML.ЗаменитьСпецСимволыHTML(МестоХраненияТекст));
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
	
	Если МестоХраненияДокументаИспользуется Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Место хранения:'"), Объект.МестоХранения);
	КонецЕсли;
	
	Если РеквизитыХраненияИспользуются(
		РеквизитыВида.УчитыватьОтветственногоЗаХранение, Объект.ОтветственныйЗаХранение, Объект.ФормаДокумента) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Отв. за хранение:'"), Объект.ОтветственныйЗаХранение);
	КонецЕсли;
	
	КомуПереданДокумент = Форма.КомуПереданДокумент;
	Если ЗначениеЗаполнено(КомуПереданДокумент) Тогда
		ДобавитьПодпись(HTMLТекст, НСтр("ru = 'Передан:'"));
		HTMLТекст = HTMLТекст + СтрШаблон(
			"<A href=v8doc:%1>%2</A><BR>",
			"holder",
			РаботаС_HTML.ЗаменитьСпецСимволыHTML(КомуПереданДокумент));
	КонецЕсли;	
	
	HTMLТекст = HTMLТекст + "</td></tr>";
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""2"">";
	
	HTMLТекст = HTMLТекст + "<p>";
	ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Папка:'"), 	Объект.Папка);
	
	Если ПолучитьФункциональнуюОпцию("ИспользоватьГрифыДоступа") Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Гриф:'"),  Объект.ГрифДоступа);
	КонецЕсли;
	
	Если ПолучитьФункциональнуюОпцию("ИспользоватьВопросыДеятельности") Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Вопрос:'"),  Объект.ВопросДеятельности);
	КонецЕсли;
	
	Если ПолучитьФункциональнуюОпцию("ВестиУчетПоПроектам") И ЗначениеЗаполнено(Объект.Проект) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Проект:'"),  Объект.Проект);
	КонецЕсли;
	
	Если ПолучитьФункциональнуюОпцию("ИспользоватьСостоянияДокументов") Тогда
		ДобавитьПодпись(HTMLТекст, НСтр("ru = 'Состояние:'"));
		HTMLТекст = HTMLТекст + СтрШаблон(
			"<A href=v8doc:%1>%2</A><BR>",
			"status",
			Форма.СостояниеТекст);
	КонецЕсли;
	
	Если РеквизитыВида.ИспользоватьУтверждение Тогда
		
		ГрифыУтверждения = Объект.ГрифыУтверждения;
		КоличествоГрифов = ГрифыУтверждения.Количество();
		Если КоличествоГрифов = 0 Тогда
			ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Утвержден:'"), НСтр("ru = 'Нет'"));
			
		ИначеЕсли КоличествоГрифов >= 1 Тогда
			ДобавитьПодпись(HTMLТекст, НСтр("ru = 'Утвержден:'"));
			Разделитель = "";
			Для каждого ГрифУтверждения из ГрифыУтверждения Цикл
				HTMLТекст = HTMLТекст + Разделитель;
				
				Если ГрифУтверждения.Результат = Перечисления.РезультатыУтверждения.Утверждено Тогда
					РезультатУтверждения = НСтр("ru = 'Да '");
				Иначе
					РезультатУтверждения = НСтр("ru = 'Нет '");
				КонецЕсли;
				ДобавитьЗначение(HTMLТекст, РезультатУтверждения);
				
				Если ЗначениеЗаполнено(ГрифУтверждения.АвторУтверждения) Тогда
					ДобавитьЗначение(HTMLТекст, ГрифУтверждения.АвторУтверждения);
				КонецЕсли; 
				Если ЗначениеЗаполнено(ГрифУтверждения.ДатаУтверждения) Тогда
					ДобавитьЗначение(HTMLТекст, " (" + Формат(ГрифУтверждения.ДатаУтверждения, "ДЛФ=D") + ")");
				КонецЕсли;
				
				Если ЗначениеЗаполнено(СокрЛП(ГрифУтверждения.Комментарий)) Тогда
					ДобавитьЗначение(HTMLТекст, " " + СокрЛП(ГрифУтверждения.Комментарий));
				КонецЕсли;
				
				Разделитель = "; ";
			КонецЦикла;
			HTMLТекст = HTMLТекст + "<br>";
		КонецЕсли;
		
	КонецЕсли;
	
	Если РеквизитыВида.ИспользоватьПодписание И Не РеквизитыВида.ВестиУчетСторон Тогда
		ДобавитьПодпись(HTMLТекст, НСтр("ru = 'Подписан:'"));
		
		Если Объект.РезультатПодписания = Перечисления.РезультатыПодписания.Подписан Тогда
			ДобавитьЗначение(HTMLТекст, "Да ");
			ДобавитьЗначение(HTMLТекст, Объект.Подписал);
			Если ЗначениеЗаполнено(Объект.ДатаПодписания) Тогда
				ДобавитьЗначение(HTMLТекст, " (" + Формат(Объект.ДатаПодписания, "ДЛФ=D") + ")");
			КонецЕсли;
		Иначе
			Если Объект.РезультатПодписания = Перечисления.РезультатыПодписания.Отклонен Тогда
				ДобавитьЗначение(HTMLТекст, НСтр("ru = 'Отклонен '"));
			Иначе
				ДобавитьЗначение(HTMLТекст, НСтр("ru = 'Нет '"));
			КонецЕсли;
			Если ЗначениеЗаполнено(Объект.Подписал) Тогда
				ДобавитьЗначение(HTMLТекст, Объект.Подписал);
			КонецЕсли;
			Если ЗначениеЗаполнено(Объект.ДатаПодписания) Тогда
				ДобавитьЗначение(HTMLТекст, " (" + Формат(Объект.ДатаПодписания, "ДЛФ=D") + ")");
			КонецЕсли;
		КонецЕсли;
		
		Если ЗначениеЗаполнено(СокрЛП(Объект.КомментарийПодписи)) Тогда
			ДобавитьЗначение(HTMLТекст, " " + СокрЛП(Объект.КомментарийПодписи));
		КонецЕсли;
		
		HTMLТекст = HTMLТекст + "<br>";
		
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Объект.ВидДокумента) Тогда 
		
		Если РеквизитыВида.ИспользоватьЭтапыОбработкиДокумента Тогда 
			ПоследнийЭтап = Неопределено;
			ДатаПоследнегоЭтапа = '00010101';
			ПройденоЭтапов = 0; ВсегоЭтапов = Форма.ЭтапыОбработкиДокументов.Количество();
			Для Каждого Строка Из Форма.ЭтапыОбработкиДокументов Цикл
				Если Строка.Пройден Тогда 
					ПройденоЭтапов = ПройденоЭтапов + 1;
					
					Если  Строка.ДатаПрохождения >= ДатаПоследнегоЭтапа Тогда 
						ПоследнийЭтап = Строка.Этап;
						ДатаПоследнегоЭтапа = Строка.ДатаПрохождения;
					КонецЕсли;
				КонецЕсли;
			КонецЦикла;
			
			Если ЗначениеЗаполнено(ПоследнийЭтап) Тогда 
				ДобавитьПодпись(HTMLТекст, НСтр("ru = 'Этапы:'"));
				HTMLТекст = HTMLТекст + СтрШаблон(
					"<A href=v8doc:%1>Пройдено %2 из %3</A>",
					"phase",
					ПройденоЭтапов,
					ВсегоЭтапов);
				ДобавитьПодпись(HTMLТекст, " " + СтрШаблон(
					НСтр("ru = '(последний ""%1"" %2)'"), 
					РаботаС_HTML.ЗаменитьСпецСимволыHTML(Строка(ПоследнийЭтап)), Формат(ДатаПоследнегоЭтапа, "ДЛФ=D")));
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Объект.Комментарий) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Комментарий:'"),  Объект.Комментарий);
	КонецЕсли;
	
	HTMLТекст = HTMLТекст + "</td></tr>";
	HTMLТекст = HTMLТекст + "</table>";
	
	HTMLТекст = HTMLТекст + "</body></html>";
	
	ОбзорОбъектовКлиентСервер.УдалитьВредоносныйКодИзТекста(HTMLТекст);
	
	Возврат HTMLТекст;
	
КонецФункции	

Функция ПолучитьОбзорВнутреннегоДокументаСКонтрагентом(Форма)

	Объект = Форма.Объект;
	Организация = Объект.Организация;
	
	// Формируем основное представление документа	
	HTMLТекст = "<html>
	|<head>
	|<style type=""text/css"">
	|	body {
	|		overflow:    auto;
	|		margin-top:  6px;
	|		margin-left: 10px;
	|		margin-bottom: 0px;
	|		font-family: Arial, sans-serif;
	|		font-size:   10pt;}
	|	table {
	|		width:       100%; 
	|		font-family: Arial, sans-serif;
	|		font-size:   10pt;}
	|	td {vertical-align: top;}
	| 	a:link {
	|		color: #006699; text-decoration: none;}
	|	a:visited {
	|		color: #006699; text-decoration: none;}
	|	a:hover {
	|		color: #006699; text-decoration: underline;}
	|	p {
	|		margin-top: 7px;}
	|</style>
	|<body>";
	
	HTMLТекст = HTMLТекст + "<table>";
	
	Если ЗначениеЗаполнено(Объект.ВидДокумента) Тогда
		HTMLТекст = HTMLТекст + "<tr>";
		HTMLТекст = HTMLТекст + "<td colspan=""2"" align=""center"">";
		
		HTMLТекст = HTMLТекст + СтрШаблон(
			"<A href=v8doc:%1>%2</A> № %3 от %4",
			ПолучитьНавигационнуюСсылку(Объект.ВидДокумента),
			ВРег(РаботаС_HTML.ЗаменитьСпецСимволыHTML((Строка(Объект.ВидДокумента)))),
			?(ЗначениеЗаполнено(Объект.РегистрационныйНомер), Объект.РегистрационныйНомер, "_____"),
			?(ЗначениеЗаполнено(Объект.ДатаРегистрации), Формат(Объект.ДатаРегистрации, "ДЛФ=D"), "_____"));
		
		HTMLТекст = HTMLТекст + "</td></tr>";
	КонецЕсли;
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""2"" align=""center"" >";
	
	HTMLТекст = HTMLТекст + "<p>";
	Заголовок = Объект.Заголовок;
	HTMLТекст = HTMLТекст + СтрШаблон(
		"<B>%1</B>",
		РаботаС_HTML.ЗаменитьСпецСимволыHTML(Заголовок));
	HTMLТекст = HTMLТекст + "</td></tr>";	
		
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""2"" >";
	
	HTMLТекст = HTMLТекст + "<p>";	
	Если ЗначениеЗаполнено(Объект.Содержание) Тогда
		Содержание = Объект.Содержание;
		HTMLТекст = HTMLТекст + СтрЗаменить(РаботаС_HTML.ЗаменитьСпецСимволыHTML(Содержание), Символы.ПС, "<br>");
		HTMLТекст = HTMLТекст + "<p>";
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Объект.ВидДокумента) Тогда 
		РеквизитыВида = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(Объект.ВидДокумента,
			"УчитыватьСуммуДокумента, ИспользоватьСрокИсполнения, ВестиУчетПоНоменклатуреДел, УчитыватьСрокДействия,
			|УчитыватьНедействующиеДокументы, ВестиУчетТоваровИУслуг, ВестиУчетПоСтатьямДДС, ВестиУчетПоОрганизациям,
			|ИспользоватьЭтапыОбработкиДокумента, ИспользоватьПодписание, ИспользоватьУтверждение,
			|ВестиУчетСторон, ВестиУчетПоКонтрагентам, ЯвляетсяЗаявкойНаОплату,
			|УчитыватьМестоХранения, УчитыватьОтветственногоЗаХранение, КонтролироватьНаличиеОригинала");
	Иначе 
		РеквизитыВида = Новый Структура;
		РеквизитыВида.Вставить("УчитыватьСуммуДокумента", Ложь);
		РеквизитыВида.Вставить("ВестиУчетТоваровИУслуг", Ложь);
		РеквизитыВида.Вставить("ИспользоватьСрокИсполнения", Ложь);
		РеквизитыВида.Вставить("ВестиУчетПоНоменклатуреДел", Ложь);
		РеквизитыВида.Вставить("УчитыватьСрокДействия", Ложь);
		РеквизитыВида.Вставить("УчитыватьНедействующиеДокументы", Ложь);
		РеквизитыВида.Вставить("ВестиУчетПоСтатьямДДС", Ложь);
		РеквизитыВида.Вставить("ВестиУчетПоОрганизациям", Ложь);
		РеквизитыВида.Вставить("ИспользоватьЭтапыОбработкиДокумента", Ложь);
		РеквизитыВида.Вставить("ИспользоватьПодписание", Ложь);
		РеквизитыВида.Вставить("ИспользоватьУтверждение", Ложь);
		РеквизитыВида.Вставить("ВестиУчетСторон", Ложь);
		РеквизитыВида.Вставить("ВестиУчетПоКонтрагентам", Ложь);
		РеквизитыВида.Вставить("ЯвляетсяЗаявкойНаОплату", Ложь);
		РеквизитыВида.Вставить("УчитыватьМестоХранения", Ложь);
		РеквизитыВида.Вставить("УчитыватьОтветственногоЗаХранение", Ложь);
		РеквизитыВида.Вставить("КонтролироватьНаличиеОригинала", Ложь);
	КонецЕсли;
	
	Если РеквизитыВида.ИспользоватьСрокИсполнения И ЗначениеЗаполнено(Объект.СрокИсполнения) Тогда 
		Состояние = Делопроизводство.ПолучитьСостояниеДокумента(Объект.Ссылка, "СостояниеИсполнение");
		Если Объект.СрокИсполнения < НачалоДня(ТекущаяДатаСеанса()) И Состояние <> Перечисления.СостоянияДокументов.Исполнен Тогда
			ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Срок исполнения:'"), Формат(Объект.СрокИсполнения, "ДЛФ=D"), "B22222");
		Иначе
			ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Срок исполнения:'"), Формат(Объект.СрокИсполнения, "ДЛФ=D"));
		КонецЕсли;
	КонецЕсли;
	
	// Сумма и статьи ДДС.
	Если РеквизитыВида.УчитыватьСуммуДокумента Тогда
		Валюта = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(Объект.Валюта, "Наименование");
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Сумма:'"), 	Формат(Объект.Сумма, "ЧДЦ=2; ЧН=0") + " " + 
			Валюта);
		
		Если Форма.УчитыватьНДС Тогда 
			ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Сумма НДС:'"), Формат(Объект.СуммаНДС, "ЧДЦ=2; ЧН=0") + " " + 
				Валюта);
		КонецЕсли;
		
		Если РеквизитыВида.ВестиУчетТоваровИУслуг И Объект.Товары.Количество() > 0 Тогда
			КоличествоПозиций = Объект.Товары.Количество();
			ДобавитьПодпись(HTMLТекст, НСтр("ru = 'Товары и услуги:'"));
			HTMLТекст = HTMLТекст + СтрШаблон(
				"<A href=%1>%2</A><BR>",
				"goods?ref=" + Строка(Объект.Ссылка.УникальныйИдентификатор()),
				Формат(КоличествоПозиций, "ЧГ=") + " "
				+ ПользователиСлужебныйКлиентСервер.ПредметЦелогоЧисла(КоличествоПозиций,
					"Л = ru_RU", НСтр("ru = 'позиция,позиции,позиций,,,,,,0'")));
		КонецЕсли;
		
		Если РеквизитыВида.ВестиУчетПоСтатьямДДС Тогда
			СтатьиДДС = Форма.СтатьиДвиженияДенежныхСредств;
			КоличествоСтатей = СтатьиДДС.Количество();
			Если КоличествоСтатей = 1 Тогда
				ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Статья ДДС:'"), 
					СтатьиДДС[0].СтатьяДвиженияДенежныхСредств);
			ИначеЕсли КоличествоСтатей > 1 Тогда
				ДобавитьПодпись(HTMLТекст, НСтр("ru = 'Статьи ДДС:'"));
				Разделитель = "";
				Для каждого Строка из СтатьиДДС Цикл
					HTMLТекст = HTMLТекст + Разделитель;
					ДобавитьЗначение(HTMLТекст, Строка.СтатьяДвиженияДенежныхСредств, "");
					Разделитель = "; ";
				КонецЦикла;
				HTMLТекст = HTMLТекст + "<br>";
			КонецЕсли;
		КонецЕсли;
		
	КонецЕсли;
	
	Если РеквизитыВида.УчитыватьСрокДействия Тогда
		СрокДействияСтрока = Форма.СрокДействияСтрока;
		ДобавитьПодпись(HTMLТекст, НСтр("ru = 'Срок действия:'"));
		HTMLТекст = HTMLТекст + СтрШаблон(
			"<A href=v8doc:%1>%2</A><BR>",
			"period",
			РаботаС_HTML.ЗаменитьСпецСимволыHTML(?(ЗначениеЗаполнено(СрокДействияСтрока),
				СрокДействияСтрока, НСтр("ru = 'не указан'"))));
	КонецЕсли;
	
	Если РеквизитыВида.УчитыватьНедействующиеДокументы Тогда
		Если Объект.НеДействует Тогда
			HTMLТекст = HTMLТекст + СтрШаблон(
				"<b><FONT color=#696969>%1</FONT></b><br>",
				НСтр("ru = 'Не действует'")) ;
		КонецЕсли;
	КонецЕсли;
		
	Если Форма.Свойства_ИспользоватьСвойства Тогда 
		Для каждого Строка Из Форма.Свойства_ОписаниеДополнительныхРеквизитов Цикл
			Значение = Форма[Строка.ИмяРеквизитаЗначение];
			Если Не Строка.Удалено И ЗначениеЗаполнено(Значение) Тогда
				ДобавитьДопРеквизит(HTMLТекст, Значение, Строка);
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;
	
	HTMLТекст = HTMLТекст + "</td></tr>";	
	
	Если РеквизитыВида.ВестиУчетПоКонтрагентам 
		И (ЗначениеЗаполнено(Объект.Контрагент) 
			Или Объект.Контрагенты.Количество()
			Или РеквизитыВида.ЯвляетсяЗаявкойНаОплату) Тогда
		
		HTMLТекст = HTMLТекст + "<tr>";
		HTMLТекст = HTMLТекст + "<td colspan=""2"" >";
		HTMLТекст = HTMLТекст + "<p>";
		
		HTMLТекст = HTMLТекст + "<tr>";
		HTMLТекст = HTMLТекст + "<td width=""70%"">";
		Если ПолучитьФункциональнуюОпцию("ИспользоватьУчетПоОрганизациям")
			И Не РеквизитыВида.ВестиУчетПоОрганизациям Тогда
			HTMLТекст = HTMLТекст + "<p>";
			ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Наше предприятие:'"), "");
		Иначе
			HTMLТекст = HTMLТекст + "<p>";
			ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Наша организация:'"), "");
			HTMLТекст = HTMLТекст + "<p>";
			ДобавитьРеквизит(HTMLТекст, "", Организация);
		КонецЕсли;
		
		Если ЗначениеЗаполнено(Объект.Утвердил) Тогда
			ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Подписал:'"), Объект.Утвердил);
		КонецЕсли;	
		
		Если Не Форма.НесколькоКонтрагентов Тогда
			HTMLТекст = HTMLТекст + "<td>";
			HTMLТекст = HTMLТекст + "<p>";	
			ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Контрагент:'"), "");
			HTMLТекст = HTMLТекст + "<p>";
			
			Если ЗначениеЗаполнено(Объект.Контрагент) Тогда
				ДобавитьРеквизит(HTMLТекст, "", Объект.Контрагент);
			КонецЕсли;
			
			Если ЗначениеЗаполнено(Объект.ПодписалОтКонтрагента) Тогда
				ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Подписал:'"), Объект.ПодписалОтКонтрагента);
			КонецЕсли;	
			
			ДобавитьВТекстДанныеКонтактногоЛица(Объект.КонтактноеЛицо, HTMLТекст, НСтр("ru = 'Контакт:'"));
		Иначе		
			HTMLТекст = HTMLТекст + "<td>";
			HTMLТекст = HTMLТекст + "<p>";
			Количество = 0;
			Для Каждого СтрокаКонтрагент Из Объект.Контрагенты Цикл
				Если ЗначениеЗаполнено(СтрокаКонтрагент.Контрагент) Тогда
					Количество = Количество + 1;
				КонецЕсли;
			КонецЦикла;
			
			Если Количество = 1 Тогда 
				ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Контрагент:'"), "");
			Иначе 
				ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Контрагенты:'"), "");
			КонецЕсли;
			
			HTMLТекст = HTMLТекст + "<p>";
			
			Для Каждого СтрокаКонтрагент Из Объект.Контрагенты Цикл
				Если ЗначениеЗаполнено(СтрокаКонтрагент.Контрагент) Тогда
					ДобавитьРеквизит(HTMLТекст, "", СтрокаКонтрагент.Контрагент);
				КонецЕсли;
				
				Если ЗначениеЗаполнено(СтрокаКонтрагент.ПодписалОтКонтрагента) Тогда
					ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Подписал:'"), СтрокаКонтрагент.ПодписалОтКонтрагента);
				КонецЕсли;	
				
				ДобавитьВТекстДанныеКонтактногоЛица(СтрокаКонтрагент.КонтактноеЛицо, HTMLТекст, НСтр("ru = 'Контакт:'"));
								
				HTMLТекст = HTMLТекст + "<p>";	
			КонецЦикла;	
			
			// Удаление лишнего отступа
			HTMLТекст = Лев(HTMLТекст, СтрДлина(HTMLТекст)-3);
		КонецЕсли;
		
		HTMLТекст = HTMLТекст + "</td></tr>";
	ИначеЕсли РеквизитыВида.ВестиУчетСторон И Объект.Стороны.Количество() Тогда
		ИспользоватьОбменЭД = ОбщегоНазначенияБЭД.ЗначениеФункциональнойОпции("ИспользоватьОбменЭД");
		
		Стороны = Новый Массив(2);
		СтрокиОрганизации = Новый Массив;
		СтрокиКонтрагенты = Новый Массив;
		
		Для Каждого СтрокаТаблицы Из Объект.Стороны Цикл
			Если РаботаСПодписямиДокументовКлиентСервер.ЭтоОрганизация(СтрокаТаблицы.Сторона) Тогда
				СтрокиОрганизации.Добавить(СтрокаТаблицы);
			Иначе
				СтрокиКонтрагенты.Добавить(СтрокаТаблицы);
			КонецЕсли;
		КонецЦикла;
		
		Если Не СтрокиКонтрагенты.Количество() Тогда
			ИндексПоследнего = СтрокиОрганизации.ВГраница();
			Для Счетчик = 1 По ИндексПоследнего Цикл
				СтрокиКонтрагенты.Добавить(СтрокиОрганизации[Счетчик]);
			КонецЦикла;
			Для Счетчик = 0 По ИндексПоследнего - 1 Цикл
				СтрокиОрганизации.Удалить(ИндексПоследнего - Счетчик);
			КонецЦикла;
		КонецЕсли;
		
		Стороны[0] = СтрокиОрганизации;
		Стороны[1] = СтрокиКонтрагенты;
		
		HTMLТекст = HTMLТекст + "<tr>";
		HTMLТекст = HTMLТекст + "<td colspan=""2"" align=""center"">";
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'СТОРОНЫ'"), "");
		HTMLТекст = HTMLТекст + "</td></tr>";

		HTMLТекст = HTMLТекст + "<tr>";
		HTMLТекст = HTMLТекст + "<td width=""70%"">";
		
		ОписаниеСостоянияЭДО = ОбменСКонтрагентамиДОСервер.ПолучитьОписаниеСостоянияЭДО(Объект.Ссылка, Форма.ЭтоДокументАннулированияЭДО);
		
		Для Каждого Сторона Из Стороны Цикл
			Для Каждого ОписаниеСтороны Из Сторона Цикл			
				Если ЗначениеЗаполнено(ОписаниеСтороны.Наименование) Тогда
					ДобавитьРеквизит(HTMLТекст, СокрЛП(ОписаниеСтороны.Наименование) + ":", "");
				КонецЕсли;
				ДобавитьРеквизит(HTMLТекст, "", ОписаниеСтороны.Сторона);
				
				Если ОписаниеСтороны.Подписан Тогда
					Подписант = ОписаниеСтороны.Подписал;
					Если ОбщегоНазначения.ЗначениеРеквизитаОбъекта(ОписаниеСтороны.Сторона, "ЮрФизЛицо") = Перечисления.ЮрФизЛицо.ФизЛицо Тогда
						Подписант = ОписаниеСтороны.Сторона;
					КонецЕсли;
					
					ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Подписал:'"), Подписант);
				КонецЕсли;
				
				Если ЗначениеЗаполнено(ОписаниеСтороны.КонтактноеЛицо) Тогда
					ДобавитьВТекстДанныеКонтактногоЛица(ОписаниеСтороны.КонтактноеЛицо, HTMLТекст, НСтр("ru = 'Контакт:'"));
				КонецЕсли;
				
				Если ИспользоватьОбменЭД
					И Не РеквизитыВида.ЯвляетсяЗаявкойНаОплату Тогда
					Если РаботаСПодписямиДокументовКлиентСервер.ЭтоКонтрагент(ОписаниеСтороны.Сторона) Тогда 
						
						ЦветСостояния = "";
						Если ОписаниеСостоянияЭДО.Свойство("СостояниеСоСтороныКонтрагентаЦвет") Тогда
							ЦветСостояния = ОписаниеСостоянияЭДО.СостояниеСоСтороныКонтрагентаЦвет;
						КонецЕсли;
						
						ДобавитьРеквизит(
							HTMLТекст,
							?(ЗначениеЗаполнено(ОписаниеСостоянияЭДО.СостояниеСоСтороныКонтрагента),
							
							НСтр("ru = 'Состояние ЭДО: '"), ""),
							?(ЗначениеЗаполнено(ОписаниеСостоянияЭДО.СостояниеСоСтороныКонтрагента),
								ОписаниеСостоянияЭДО.СостояниеСоСтороныКонтрагента, ""),
							ЦветСостояния);
						
					ИначеЕсли ЗначениеЗаполнено(ОписаниеСостоянияЭДО.СостояниеСНашейСтороны) Тогда
						
						ЦветСостояния = "";
						Если ОписаниеСостоянияЭДО.Свойство("СостояниеСНашейСтороныЦвет") Тогда
							ЦветСостояния = ОписаниеСостоянияЭДО.СостояниеСНашейСтороныЦвет;
						КонецЕсли;
						
						ДобавитьРеквизит(
							HTMLТекст,
							НСтр("ru = 'Состояние ЭДО: '"),
							ОписаниеСостоянияЭДО.СостояниеСНашейСтороны,
							ЦветСостояния);
						
					КонецЕсли;
				КонецЕсли;
				
				HTMLТекст = HTMLТекст + "<p>";
			КонецЦикла;	
			HTMLТекст = HTMLТекст + "</td><td>";
		КонецЦикла;
				
		HTMLТекст = HTMLТекст + "</td></tr>";
	КонецЕсли;
	
	HTMLТекст = HTMLТекст + "<tr>";
	HTMLТекст = HTMLТекст + "<td colspan=""2"">";
	
	HTMLТекст = HTMLТекст + "<p>";
	
	Если ЗначениеЗаполнено(Объект.Подготовил) Тогда
		ДобавитьПодпись(HTMLТекст, НСтр("ru = 'Подготовил:'"));
		ДобавитьЗначение(HTMLТекст, Объект.Подготовил, "");
		ДобавитьЗначение(HTMLТекст, " (" + Формат(Объект.ДатаСоздания, "ДЛФ=D") + ")", "");
		HTMLТекст = HTMLТекст + "<br>";
		
		КонтактнаяИнформация = ПолучитьКонтактнуюИнформацияОбъекта(Объект.Подготовил);
		
		Если ЗначениеЗаполнено(КонтактнаяИнформация.Телефон) Тогда
			ДобавитьРеквизит(HTMLТекст, "", КонтактнаяИнформация.Телефон, "696969");
		КонецЕсли;
		
		Если ЗначениеЗаполнено(КонтактнаяИнформация.Емайл) Тогда
			HTMLТекст = HTMLТекст + СтрШаблон(
				"<FONT color=#696969>%1</FONT>",
				НСтр("ru = 'E-mail:'") + " ");
			HTMLТекст = HTMLТекст + СтрШаблон(
				"<A color=#696969 href=v8doc:%1><FONT color=#696969>%2</FONT></A><BR>",
				"message"+КонтактнаяИнформация.Емайл,
				РаботаС_HTML.ЗаменитьСпецСимволыHTML(КонтактнаяИнформация.Емайл));
		КонецЕсли;
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Объект.Подразделение) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Подразделение:'"),  Объект.Подразделение);
	КонецЕсли;	
	
	Если ЗначениеЗаполнено(Объект.Ответственный) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Ответственный:'"),  Объект.Ответственный);
	КонецЕсли;
	
	Если РеквизитыВида.КонтролироватьНаличиеОригинала И ЗначениеЗаполнено(Форма.ОригиналПолученТекст) Тогда 
		Если Не Форма.ОригиналПолучен И ЗначениеЗаполнено(Объект.РегистрационныйНомер) Тогда 
			ДобавитьПодпись(HTMLТекст, НСтр("ru = 'Оригинал:'"));
			HTMLТекст = HTMLТекст + СтрШаблон(
				"<A href=v8doc:%1><FONT color=#%2>%3</FONT></A><BR>",
				"Original",
				"B22222",
				РаботаС_HTML.ЗаменитьСпецСимволыHTML(Форма.ОригиналПолученТекст));
		Иначе 
			ДобавитьПодпись(HTMLТекст, НСтр("ru = 'Оригинал:'"));
			HTMLТекст = HTMLТекст + СтрШаблон(
				"<A href=v8doc:%1>%2</A><BR>",
				"Original",
				РаботаС_HTML.ЗаменитьСпецСимволыHTML(Форма.ОригиналПолученТекст));
		КонецЕсли;
	КонецЕсли;
	
	Если ПолучитьФункциональнуюОпцию("РаздельныйУчетДокументов") И ЗначениеЗаполнено(Объект.ФормаДокумента) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Форма:'"), Объект.ФормаДокумента);
	КонецЕсли;
	
	МестоХраненияДокументаИспользуется = РеквизитыХраненияИспользуются(
		РеквизитыВида.УчитыватьМестоХранения, Объект.МестоХранения, Объект.ФормаДокумента);
	
	Если ПолучитьФункциональнуюОпцию("ИспользоватьНоменклатуруДел") Тогда 
		Если РеквизитыВида.ВестиУчетПоНоменклатуреДел И ЗначениеЗаполнено(Объект.НоменклатураДел) Тогда
			ДобавитьПодпись(HTMLТекст,  НСтр("ru = 'Номенклатура дел:'"));
			HTMLТекст = HTMLТекст + СтрШаблон(
				"<A href=v8doc:%1>%2</A><BR>",
				ПолучитьНавигационнуюСсылку(Объект.НоменклатураДел),
				Объект.НоменклатураДел);
		КонецЕсли;
		
		ДелоТекст = Форма.ДелоТекст;
		Если ЗначениеЗаполнено(ДелоТекст) Тогда
			ДобавитьПодпись(HTMLТекст,  НСтр("ru = 'Помещен в дело:'"));
			HTMLТекст = HTMLТекст + СтрШаблон(
				"<A href=v8doc:%1>%2</A><BR>",
				"dossier",
				РаботаС_HTML.ЗаменитьСпецСимволыHTML(ДелоТекст));
			
			СостояниеДела = СостояниеДела(Объект.Дело);
			Если ЗначениеЗаполнено(СостояниеДела) Тогда
				ДобавитьРеквизит(HTMLТекст, СостояниеДела.Состояние, СостояниеДела.ДатаСостояния);
			КонецЕсли;
			
			МестоХранения = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(Объект.Дело, "МестоХраненияДел");
			Если ЗначениеЗаполнено(МестоХранения) Тогда
				МестоХраненияТекст = ДелопроизводствоКлиентСервер.ПолучитьПолныйПутьКМестуХранения(МестоХранения,
					ПолучитьФункциональнуюОпцию("ИспользоватьСхемыПомещений"));
				Если МестоХраненияДокументаИспользуется Тогда
					ДобавитьПодпись(HTMLТекст,  НСтр("ru = 'Место хранения дела:'"));
				Иначе
					ДобавитьПодпись(HTMLТекст,  НСтр("ru = 'Место хранения:'"));
				КонецЕсли;
				HTMLТекст = HTMLТекст + СтрШаблон(
					"<A href=v8doc:%1>%2</A><BR>",
					"storage",
					РаботаС_HTML.ЗаменитьСпецСимволыHTML(МестоХраненияТекст));
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
	
	Если МестоХраненияДокументаИспользуется Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Место хранения:'"), Объект.МестоХранения);
	КонецЕсли;
	
	Если РеквизитыХраненияИспользуются(
		РеквизитыВида.УчитыватьОтветственногоЗаХранение, Объект.ОтветственныйЗаХранение, Объект.ФормаДокумента) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Отв. за хранение:'"), Объект.ОтветственныйЗаХранение);
	КонецЕсли;
	
	КомуПереданДокумент = Форма.КомуПереданДокумент;
	Если ЗначениеЗаполнено(КомуПереданДокумент) Тогда
		ДобавитьПодпись(HTMLТекст, НСтр("ru = 'Передан:'"));
		HTMLТекст = HTMLТекст + СтрШаблон(
			"<A href=v8doc:%1>%2</A><BR>",
			"holder",
			РаботаС_HTML.ЗаменитьСпецСимволыHTML(КомуПереданДокумент));
	КонецЕсли;	
	
	HTMLТекст = HTMLТекст + "</td></tr>";
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""2"">";
	
	HTMLТекст = HTMLТекст + "<p>";
	ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Папка:'"), 	Объект.Папка);
	
	Если ПолучитьФункциональнуюОпцию("ИспользоватьГрифыДоступа") Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Гриф:'"),  Объект.ГрифДоступа);
	КонецЕсли;
	
	Если ПолучитьФункциональнуюОпцию("ИспользоватьВопросыДеятельности") Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Вопрос:'"),  Объект.ВопросДеятельности);
	КонецЕсли;
	
	Если ПолучитьФункциональнуюОпцию("ВестиУчетПоПроектам") И ЗначениеЗаполнено(Объект.Проект) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Проект:'"),  Объект.Проект);
	КонецЕсли;

	Если ПолучитьФункциональнуюОпцию("ИспользоватьСостоянияДокументов") Тогда
		ДобавитьПодпись(HTMLТекст, НСтр("ru = 'Состояние:'"));
		HTMLТекст = HTMLТекст + СтрШаблон(
			"<A href=v8doc:%1>%2</A><BR>",
			"status",
			Форма.СостояниеТекст);
	КонецЕсли;
	
	Если РеквизитыВида.ИспользоватьУтверждение Тогда
		
		ГрифыУтверждения = Объект.ГрифыУтверждения;
		КоличествоГрифов = ГрифыУтверждения.Количество();
		Если КоличествоГрифов <= 1 Тогда
			ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Утвержден:'"), 
				ДелопроизводствоКлиентСервер.ПолучитьСтрокуУтверждения(Объект));
		ИначеЕсли КоличествоГрифов > 1 Тогда
			ДобавитьПодпись(HTMLТекст, НСтр("ru = 'Грифы утверждения:'"));
			Разделитель = "";
			Для каждого ГрифУтверждения из ГрифыУтверждения Цикл
				HTMLТекст = HTMLТекст + Разделитель;
				СтрокаУтверждение = "";		
				
				Если ГрифУтверждения.Результат = ПредопределенноеЗначение("Перечисление.РезультатыУтверждения.Утверждено") Тогда
					РезультатУтверждения = НСтр("ru = 'Утвержден'");
				Иначе
					РезультатУтверждения = НСтр("ru = 'Не утвержден'");
				КонецЕсли;
				
				Если ЗначениеЗаполнено(ГрифУтверждения.ДатаУтверждения) Тогда
					СтрокаУтверждение = СтрШаблон("%1 (%2, %3)",
						РезультатУтверждения,
						ГрифУтверждения.АвторУтверждения,
						Формат(ГрифУтверждения.ДатаУтверждения, "ДЛФ=D"));
				Иначе
					СтрокаУтверждение = СтрШаблон("%1 (%2)",
						РезультатУтверждения, ГрифУтверждения.АвторУтверждения);
				КонецЕсли;
				
				ДобавитьЗначение(HTMLТекст, СтрокаУтверждение, "");
				
				Разделитель = "; ";
			КонецЦикла;
			HTMLТекст = HTMLТекст + "<br>";
		КонецЕсли;	
		
	КонецЕсли;	
	
	Если ЗначениеЗаполнено(Объект.ВидДокумента) Тогда 
		
		Если РеквизитыВида.ИспользоватьЭтапыОбработкиДокумента Тогда 
			ПоследнийЭтап = Неопределено;
			ДатаПоследнегоЭтапа = '00010101';
			ПройденоЭтапов = 0; ВсегоЭтапов = Форма.ЭтапыОбработкиДокументов.Количество();
			Для Каждого Строка Из Форма.ЭтапыОбработкиДокументов Цикл
				Если Строка.Пройден Тогда 
					ПройденоЭтапов = ПройденоЭтапов + 1;
					
					Если  Строка.ДатаПрохождения >= ДатаПоследнегоЭтапа Тогда 
						ПоследнийЭтап = Строка.Этап;
						ДатаПоследнегоЭтапа = Строка.ДатаПрохождения;
					КонецЕсли;
				КонецЕсли;
			КонецЦикла;
			
			Если ЗначениеЗаполнено(ПоследнийЭтап) Тогда 
				ДобавитьПодпись(HTMLТекст, НСтр("ru = 'Этапы:'"));
				HTMLТекст = HTMLТекст + СтрШаблон(
					"<A href=v8doc:%1>Пройдено %2 из %3</A>",
					"phase",
					ПройденоЭтапов,
					ВсегоЭтапов);
				ДобавитьПодпись(HTMLТекст, " " + СтрШаблон(
					НСтр("ru = '(последний ""%1"" %2)'"), 
					РаботаС_HTML.ЗаменитьСпецСимволыHTML(Строка(ПоследнийЭтап)),
					Формат(ДатаПоследнегоЭтапа, "ДЛФ=D")));
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Объект.Комментарий) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Комментарий:'"),  Объект.Комментарий);
	КонецЕсли;
	
	HTMLТекст = HTMLТекст + "</td></tr>";	
	HTMLТекст = HTMLТекст + "</table>";
	
	HTMLТекст = HTMLТекст + "</body></html>";
	
	ОбзорОбъектовКлиентСервер.УдалитьВредоносныйКодИзТекста(HTMLТекст);
	
	Возврат HTMLТекст;
	
КонецФункции	

Функция СостояниеДела(Дело)
	
	СтруктураСостояния = Новый Структура;
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	СостоянияДелХраненияДокументов.Состояние КАК Состояние,
		|	СостоянияДелХраненияДокументов.Период КАК Период
		|ИЗ
		|	РегистрСведений.СостоянияДелХраненияДокументов.СрезПоследних(, ДелоХраненияДокументов = &Дело) КАК СостоянияДелХраненияДокументов";
	Запрос.УстановитьПараметр("Дело", Дело);
	
	Результат = Запрос.Выполнить();
	Если Не Результат.Пустой() Тогда 
		Выборка = Результат.Выбрать();
		Выборка.Следующий();
		
		Если Выборка.Состояние = Перечисления.СостоянияДелХраненияДокументов.ПереданоВАрхив Тогда 
			Состояние = НСтр("ru = 'Дело передано в архив:'");
		ИначеЕсли Выборка.Состояние = Перечисления.СостоянияДелХраненияДокументов.Уничтожено Тогда 
			Состояние = НСтр("ru = 'Дело уничтожено:'");
		КонецЕсли;
		
		ДатаСостояния = Формат(Выборка.Период, "ДЛФ=D");
		
		СтруктураСостояния.Вставить("Состояние", Состояние);
		СтруктураСостояния.Вставить("ДатаСостояния", ДатаСостояния);
	КонецЕсли;
	
	Возврат СтруктураСостояния;
	
КонецФункции

Процедура ДобавитьПодпись(HTMLТекст, Подпись)
	
	Если ЗначениеЗаполнено(Подпись) Тогда 
		HTMLТекст = HTMLТекст + "<FONT color=#413003>";
		HTMLТекст = HTMLТекст + Подпись + " ";
		HTMLТекст = HTMLТекст + "</FONT>";
	КонецЕсли;
	
КонецПроцедуры

Процедура ДобавитьЗначение(HTMLТекст, ЗначениеДанных, Цвет = "")
	
	Значение = ЗначениеДанных;
	
	Если Не ОбщегоНазначения.ЭтоСсылка(ТипЗнч(Значение))
	 Или ОбщегоНазначения.ЭтоПеречисление(Значение.Метаданные()) Тогда 
		Если ЗначениеЗаполнено(Цвет) Тогда 
			HTMLТекст = HTMLТекст + "<FONT color=#"+Цвет+">";
			HTMLТекст = HTMLТекст + РаботаС_HTML.ЗаменитьСпецСимволыHTML(Значение);
			HTMLТекст = HTMLТекст + "</FONT>";
		Иначе	
			HTMLТекст = HTMLТекст + РаботаС_HTML.ЗаменитьСпецСимволыHTML(Значение);
		КонецЕсли;
	Иначе
		HTMLТекст = HTMLТекст + СтрШаблон(
			"<A href=v8doc:%1>%2</A>",
			ПолучитьНавигационнуюСсылку(Значение),
			РаботаС_HTML.ЗаменитьСпецСимволыHTML(Строка(Значение)));
	КонецЕсли;
	
КонецПроцедуры

Процедура ДобавитьРеквизит(HTMLТекст, Подпись, Значение, Цвет = "")
	
	ДобавитьПодпись(HTMLТекст, Подпись);
	ДобавитьЗначение(HTMLТекст, Значение, Цвет); 
	HTMLТекст = HTMLТекст + "<br>";
	
КонецПроцедуры

Процедура ДобавитьДопРеквизит(HTMLТекст, Значение, Строка)
	
	ФорматСвойства = Строка.Свойство.ФорматСвойства;
	
	Если Не ЗначениеЗаполнено(ФорматСвойства) Тогда 
		ТипЗначения = Строка.Свойство.ТипЗначения;
		
		Если ТипЗначения.СодержитТип(Тип("Дата")) Тогда 
			Если ТипЗначения.КвалификаторыДаты.ЧастиДаты = ЧастиДаты.Время Тогда 
				ФорматСвойства = ФорматСвойства + "ДЛФ = 'T';";
			ИначеЕсли ТипЗначения.КвалификаторыДаты.ЧастиДаты = ЧастиДаты.Дата Тогда 
				ФорматСвойства = ФорматСвойства + "ДЛФ = 'D';";
			ИначеЕсли ТипЗначения.КвалификаторыДаты.ЧастиДаты = ЧастиДаты.ДатаВремя Тогда 	
				ФорматСвойства = ФорматСвойства + "ДЛФ = 'DT';";
			КонецЕсли;	
		КонецЕсли;	
		
		Если ТипЗначения.СодержитТип(Тип("Число")) Тогда 	
			Разрядность = ТипЗначения.КвалификаторыЧисла.Разрядность;
			РазрядностьДробнойЧасти = ТипЗначения.КвалификаторыЧисла.РазрядностьДробнойЧасти;
			
			ФорматСвойства = ФорматСвойства + "ЧЦ = '" + Разрядность + "';";
			ФорматСвойства = ФорматСвойства + "ЧДЦ = '" + РазрядностьДробнойЧасти + "';";
		КонецЕсли;	
	КонецЕсли;		
	
	Если ЗначениеЗаполнено(ФорматСвойства) Тогда 
		ДобавитьРеквизит(HTMLТекст, Строка(Строка.Наименование) + ":", Формат(Значение, ФорматСвойства));
	Иначе
		ДобавитьРеквизит(HTMLТекст, Строка(Строка.Наименование) + ":", Значение);
	КонецЕсли;	
	
КонецПроцедуры	

// Добавляет в текст HTML данные контактного лица
Процедура ДобавитьВТекстДанныеКонтактногоЛица(КонтактноеЛицо, HTMLТекст, ЗаголовокКонтактногоЛица = "")
		
	Если Не ЗначениеЗаполнено(КонтактноеЛицо) Тогда
		Возврат;
	КонецЕсли;
	
	ДобавитьРеквизит(HTMLТекст, ЗаголовокКонтактногоЛица, КонтактноеЛицо);
	КонтактнаяИнформация = ПолучитьКонтактнуюИнформацияОбъекта(КонтактноеЛицо);
	
	Если ЗначениеЗаполнено(КонтактнаяИнформация.Телефон) Тогда
		ДобавитьРеквизит(HTMLТекст, "", КонтактнаяИнформация.Телефон, "696969");
	КонецЕсли;
	
	Если ЗначениеЗаполнено(КонтактнаяИнформация.Емайл) Тогда
		HTMLТекст = HTMLТекст + СтрШаблон(
			"<FONT color=#696969>%1</FONT>",
			НСтр("ru = 'E-mail:'") + " ");
		HTMLТекст = HTMLТекст + СтрШаблон(
			"<A color=#696969 href=v8doc:%1><FONT color=#696969>%2</FONT></A><BR>",
			"message"+КонтактнаяИнформация.Емайл,
			РаботаС_HTML.ЗаменитьСпецСимволыHTML(КонтактнаяИнформация.Емайл));
	КонецЕсли;
	
КонецПроцедуры

Функция ПолучитьКонтактнуюИнформацияОбъекта(Пользователь)
	
	КонтактнаяИнформация = Новый Структура;
	Емайл = "";Телефон = "";
	
	Если ТипЗнч(Пользователь) = Тип("СправочникСсылка.Пользователи") Тогда
		Емайл = УправлениеКонтактнойИнформацией.ПредставлениеКонтактнойИнформацииОбъекта(
			Пользователь,
			Справочники.ВидыКонтактнойИнформации.EmailПользователя,,
			ТекущаяДатаСеанса());
		Телефон = УправлениеКонтактнойИнформацией.ПредставлениеКонтактнойИнформацииОбъекта(
			Пользователь,
			Справочники.ВидыКонтактнойИнформации.ТелефонПользователя,,
			ТекущаяДатаСеанса());
	ИначеЕсли ТипЗнч(Пользователь) = Тип("СправочникСсылка.КонтактныеЛица") Тогда
		Емайл = УправлениеКонтактнойИнформацией.ПредставлениеКонтактнойИнформацииОбъекта(
			Пользователь,
			Справочники.ВидыКонтактнойИнформации.EmailКонтактногоЛица,,
			ТекущаяДатаСеанса());
		Телефон = УправлениеКонтактнойИнформацией.ПредставлениеКонтактнойИнформацииОбъекта(
			Пользователь,
			Справочники.ВидыКонтактнойИнформации.ТелефонКонтактногоЛица,,
			ТекущаяДатаСеанса());
	ИначеЕсли ТипЗнч(Пользователь) = Тип("СправочникСсылка.Контрагенты") Тогда
		Емайл = УправлениеКонтактнойИнформацией.ПредставлениеКонтактнойИнформацииОбъекта(
			Пользователь,
			Справочники.ВидыКонтактнойИнформации.EmailКонтрагента,,
			ТекущаяДатаСеанса());
		Телефон = УправлениеКонтактнойИнформацией.ПредставлениеКонтактнойИнформацииОбъекта(
			Пользователь,
			Справочники.ВидыКонтактнойИнформации.ТелефонКонтрагента,,
			ТекущаяДатаСеанса());
	КонецЕсли; 
	
	Если ЗначениеЗаполнено(Телефон) Тогда 
		КонтактнаяИнформация.Вставить("Телефон", СтрШаблон(
			НСтр("ru = 'Телефон: %1'"), Телефон));	
	Иначе
		КонтактнаяИнформация.Вставить("Телефон", Телефон);
	КонецЕсли;			

	КонтактнаяИнформация.Вставить("Емайл", Емайл);

	Возврат КонтактнаяИнформация;
	
КонецФункции	

Функция ПолучитьОбзорШаблонаВнутреннегоДокумента(Объект) Экспорт 
	
	HTMLТекст = ОбзорДокументаПереопределяемый.ПолучитьОбзорШаблонаВнутреннегоДокумента(Объект);
	Если ЗначениеЗаполнено(HTMLТекст) Тогда 
		Возврат HTMLТекст;
	КонецЕсли;
	
	ПараметрыУчета = Новый Структура;
	ПараметрыУчета.Вставить("ВестиУчетСторон", Ложь);
	ПараметрыУчета.Вставить("ВестиУчетПоКонтрагентам", Ложь);
	
	Если ЗначениеЗаполнено(Объект.ВидДокумента) Тогда
		ПараметрыУчета = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(Объект.ВидДокумента,
			"ВестиУчетСторон, ВестиУчетПоКонтрагентам");
	КонецЕсли;
	
	Если ПараметрыУчета.ВестиУчетСторон Или ПараметрыУчета.ВестиУчетПоКонтрагентам Тогда
		Возврат ПолучитьОбзорШаблонаВнутреннегоДокументаСКонтрагентом(Объект);
	Иначе	
		Возврат ПолучитьОбзорШаблонаВнутреннегоДокументаБезКонтрагента(Объект);
	КонецЕсли;	
	
КонецФункции	

Функция ПолучитьОбзорШаблонаВнутреннегоДокументаБезКонтрагента(Объект)
	
	РеквизитыОбъекта = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(Объект,
		"Организация, ВидДокумента, Заголовок, Содержание, ДлительностьИсполнения, НоменклатураДел,
		|ГрифДоступа, Папка, ВопросДеятельности, Ответственный, КомментарийКДокументу, КомментарийКШаблону,
		|Автор, Подписант, ГрифыУтверждения");
		
	Организация = РеквизитыОбъекта.Организация;
	
	HTMLТекст = "<html>
	|<head>
	|<style type=""text/css"">
	|	body {
	|		overflow:    auto;
	|		margin-top:  6px; 		 
	|		margin-left: 10px; 
	|		font-family: Arial, sans-serif;
	|		font-size:   10pt;}
	|	table {
	|		width:       100%; 
	|		font-family: Arial, sans-serif;
	|		font-size:   10pt;}
	|	td {vertical-align: top;}
	| 	a:link {
	|		color: #006699; text-decoration: none;}
	|	a:visited {
	|		color: #006699; text-decoration: none;}
	|	a:hover {
	|		color: #006699; text-decoration: underline;}
	|	p {
	|		margin-top: 7px;}
	|</style>
	|<body>";
	
	HTMLТекст = HTMLТекст + "<table>";
	
	HTMLТекст = HTMLТекст + "<tr>";
	HTMLТекст = HTMLТекст + "<td colspan=""2"" align=""center"">";
	ДобавитьРеквизит(HTMLТекст, "", Организация);
	HTMLТекст = HTMLТекст + "</td>";
	HTMLТекст = HTMLТекст + "</tr>";
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""2"" align=""center"">";
	HTMLТекст = HTMLТекст + "<p>";
	HTMLТекст = HTMLТекст + СтрШаблон(
		"<A href=v8doc:%1>%2</A>",
		ПолучитьНавигационнуюСсылку(РеквизитыОбъекта.ВидДокумента),
		ВРег(РаботаС_HTML.ЗаменитьСпецСимволыHTML(Строка(РеквизитыОбъекта.ВидДокумента))));
	HTMLТекст = HTMLТекст + "</td>";
	HTMLТекст = HTMLТекст + "</tr>";
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""2"">";
	
	HTMLТекст = HTMLТекст + "<p>";
	Заголовок = РеквизитыОбъекта.Заголовок;
	HTMLТекст = HTMLТекст + СтрШаблон(
		"<B>%1</B>",
		РаботаС_HTML.ЗаменитьСпецСимволыHTML(Заголовок));
	HTMLТекст = HTMLТекст + "<p>";
		
	HTMLТекст = HTMLТекст + "<p>";	
	Если ЗначениеЗаполнено(РеквизитыОбъекта.Содержание) Тогда
		Содержание = РеквизитыОбъекта.Содержание;
		HTMLТекст = HTMLТекст + СтрЗаменить(РаботаС_HTML.ЗаменитьСпецСимволыHTML(Содержание), Символы.ПС, "<br>");
		HTMLТекст = HTMLТекст + "<p>";
	КонецЕсли;
	
	Если ЗначениеЗаполнено(РеквизитыОбъекта.ДлительностьИсполнения) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Длительность исполнения (дней):'"), Строка(РеквизитыОбъекта.ДлительностьИсполнения));
	КонецЕсли;
				 
	Для каждого Строка Из Объект.ДополнительныеРеквизиты Цикл
		Значение = Строка.Значение;
		Если Значение <> Неопределено или ЗначениеЗаполнено(Значение) Тогда
			СтруктураСтрока = Новый Структура;
			СтруктураСтрока.Вставить("Свойство", Строка.Свойство);
			СтруктураСтрока.Вставить("Наименование", Строка(Строка.Свойство));
			ДобавитьДопРеквизит(HTMLТекст, Значение, СтруктураСтрока);
		КонецЕсли;	
	КонецЦикла;			
		
	HTMLТекст = HTMLТекст + "</td></tr>";	
		
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""2"">";
	
	HTMLТекст = HTMLТекст + "<p>";
	Если ЗначениеЗаполнено(РеквизитыОбъекта.ВидДокумента) 
		И ОбщегоНазначения.ЗначениеРеквизитаОбъекта(РеквизитыОбъекта.ВидДокумента, "ВестиУчетПоНоменклатуреДел")
		И ЗначениеЗаполнено(РеквизитыОбъекта.НоменклатураДел) Тогда			
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Номенклатура дел:'"), РеквизитыОбъекта.НоменклатураДел);
	КонецЕсли;
	
	HTMLТекст = HTMLТекст + "</td></tr>";
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""2"">";
	
	HTMLТекст = HTMLТекст + "<p>";
	
	Если ЗначениеЗаполнено(РеквизитыОбъекта.ВидДокумента) Тогда
		РеквизитыВидаДокумента = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(РеквизитыОбъекта.ВидДокумента, "ВестиУчетСторон, ИспользоватьПодписание");
		Если РеквизитыВидаДокумента.ИспользоватьПодписание
			И Не РеквизитыВидаДокумента.ВестиУчетСторон
			И ЗначениеЗаполнено(РеквизитыОбъекта.Подписант) Тогда
				ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Подписывает:'"), РеквизитыОбъекта.Подписант);
		КонецЕсли;
	КонецЕсли;
	
	Если ЗначениеЗаполнено(РеквизитыОбъекта.ВидДокумента)
		И ОбщегоНазначения.ЗначениеРеквизитаОбъекта(РеквизитыОбъекта.ВидДокумента, "ИспользоватьУтверждение") Тогда
			ГрифыУтверждения = РеквизитыОбъекта.ГрифыУтверждения.Выгрузить();
			Если ГрифыУтверждения.Количество() > 0 Тогда
				ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Утверждает:'"), ГрифыУтверждения[0].АвторУтверждения);
			КонецЕсли;
	КонецЕсли;
	
	Если ЗначениеЗаполнено(РеквизитыОбъекта.Папка) Тогда  
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Папка:'"), РеквизитыОбъекта.Папка);
	КонецЕсли;
	
	Если ПолучитьФункциональнуюОпцию("ИспользоватьГрифыДоступа")
		И ЗначениеЗаполнено(РеквизитыОбъекта.ГрифДоступа) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Гриф:'"),  РеквизитыОбъекта.ГрифДоступа);
	КонецЕсли;
	
	Если ПолучитьФункциональнуюОпцию("ИспользоватьВопросыДеятельности")
		И ЗначениеЗаполнено(РеквизитыОбъекта.ВопросДеятельности) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Вопрос:'"),  РеквизитыОбъекта.ВопросДеятельности);
	КонецЕсли;
		
	Если ЗначениеЗаполнено(РеквизитыОбъекта.Ответственный) Тогда 
		ДобавитьВТекстДанныеКонтактногоЛица(РеквизитыОбъекта.Ответственный, HTMLТекст, НСтр("ru = 'Ответственный:'"));
	КонецЕсли;
	
	HTMLТекст = HTMLТекст + "</td></tr>";
	
	HTMLТекст = HTMLТекст + "<tr>";
	HTMLТекст = HTMLТекст + "<td>";
	
	Если ЗначениеЗаполнено(РеквизитыОбъекта.КомментарийКДокументу) Тогда
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Комментарий к документу:'"), РеквизитыОбъекта.КомментарийКДокументу);
	КонецЕсли;
	HTMLТекст = HTMLТекст + "</td>";
	HTMLТекст = HTMLТекст + "</tr>";
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""3"">";
	HTMLТекст = HTMLТекст + "<p>";
	
	Если ЗначениеЗаполнено(РеквизитыОбъекта.КомментарийКШаблону) Тогда			
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Комментарий к шаблону:'"), РеквизитыОбъекта.КомментарийКШаблону);
	КонецЕсли;
	
	HTMLТекст = HTMLТекст + "</td></tr>";
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td>";

	Если ЗначениеЗаполнено(РеквизитыОбъекта.Автор) Тогда
		ДобавитьВТекстДанныеКонтактногоЛица(
			РеквизитыОбъекта.Автор,
			HTMLТекст,
			НСтр("ru = 'Кому задавать вопросы по шаблону:'"));
	КонецЕсли;
	
	HTMLТекст = HTMLТекст + "</td></tr>";
	
	HTMLТекст = HTMLТекст + "</table>";
	HTMLТекст = HTMLТекст + "</body></html>";
	
	ОбзорОбъектовКлиентСервер.УдалитьВредоносныйКодИзТекста(HTMLТекст);
	
	Возврат HTMLТекст;
	
КонецФункции	

Функция ПолучитьОбзорШаблонаВнутреннегоДокументаСКонтрагентом(Объект)

	РеквизитыОбъекта = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(Объект,
		"Организация, ВидДокумента, Заголовок, Содержание, ДлительностьИсполнения, НоменклатураДел,
		|ГрифДоступа, Папка, ВопросДеятельности, Ответственный, КомментарийКДокументу, КомментарийКШаблону,
		|Автор, Подписант, ГрифыУтверждения");

	РеквизитыВида = Новый Структура;
	РеквизитыВида.Вставить("ВестиУчетСторон", Ложь);
	РеквизитыВида.Вставить("ВестиУчетПоКонтрагентам", Ложь);
	РеквизитыВида.Вставить("ВестиУчетПоНоменклатуреДел", Ложь);
	РеквизитыВида.Вставить("ИспользоватьПодписание", Ложь);
	РеквизитыВида.Вставить("ИспользоватьУтверждение", Ложь);
	
	Если ЗначениеЗаполнено(РеквизитыОбъекта.ВидДокумента) Тогда
		РеквизитыВида = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(РеквизитыОбъекта.ВидДокумента,
			"ВестиУчетСторон, ВестиУчетПоКонтрагентам, ВестиУчетПоНоменклатуреДел, ИспользоватьПодписание,
			|ИспользоватьУтверждение");
	КонецЕсли;
		
	Организация = РеквизитыОбъекта.Организация;
	
	HTMLТекст = "<html>
	|<head>
	|<style type=""text/css"">
	|	body {
	|		overflow:    auto;
	|		margin-top:  6px; 		 
	|		margin-left: 10px; 
	|		font-family: Arial, sans-serif;
	|		font-size:   10pt;}
	|	table {
	|		width:       100%; 
	|		font-family: Arial, sans-serif;
	|		font-size:   10pt;}
	|	td {vertical-align: top;}
	| 	a:link {
	|		color: #006699; text-decoration: none;}
	|	a:visited {
	|		color: #006699; text-decoration: none;}
	|	a:hover {
	|		color: #006699; text-decoration: underline;}
	|	p {
	|		margin-top: 7px;}
	|</style>
	|<body>";
	
	HTMLТекст = HTMLТекст + "<table>";
	
	HTMLТекст = HTMLТекст + "<tr>";
	HTMLТекст = HTMLТекст + "<td colspan=""2"" align=""center"">";
	ДобавитьРеквизит(HTMLТекст, "", Организация);
	HTMLТекст = HTMLТекст + "</td>";
	HTMLТекст = HTMLТекст + "</tr>";
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""2"" align=""center"">";
	HTMLТекст = HTMLТекст + "<p>";
	HTMLТекст = HTMLТекст + СтрШаблон(
		"<A href=v8doc:%1>%2</A>",
		ПолучитьНавигационнуюСсылку(РеквизитыОбъекта.ВидДокумента),
		ВРег(РаботаС_HTML.ЗаменитьСпецСимволыHTML(Строка(РеквизитыОбъекта.ВидДокумента))));
	HTMLТекст = HTMLТекст + "</td>";
	HTMLТекст = HTMLТекст + "</tr>";
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""2"">";
	
	HTMLТекст = HTMLТекст + "<p>";
	Заголовок = РеквизитыОбъекта.Заголовок;
	HTMLТекст = HTMLТекст + СтрШаблон(
		"<B>%1</B>",
		РаботаС_HTML.ЗаменитьСпецСимволыHTML(Заголовок));
	HTMLТекст = HTMLТекст + "<p>";
		
	HTMLТекст = HTMLТекст + "<p>";	
	Если ЗначениеЗаполнено(РеквизитыОбъекта.Содержание) Тогда
		Содержание = РеквизитыОбъекта.Содержание;
		HTMLТекст = HTMLТекст + СтрЗаменить(РаботаС_HTML.ЗаменитьСпецСимволыHTML(Содержание), Символы.ПС, "<br>");
		HTMLТекст = HTMLТекст + "<p>";
	КонецЕсли;
	
	Если ЗначениеЗаполнено(РеквизитыОбъекта.ДлительностьИсполнения) Тогда 
		ДобавитьРеквизит(
			HTMLТекст,
			НСтр("ru = 'Длительность исполнения (дней):'"),
			Строка(РеквизитыОбъекта.ДлительностьИсполнения));
	КонецЕсли;
				 
	Для каждого Строка Из Объект.ДополнительныеРеквизиты Цикл
		Значение = Строка.Значение;
		Если Значение <> Неопределено или ЗначениеЗаполнено(Значение) Тогда
			СтруктураСтрока = Новый Структура;
			СтруктураСтрока.Вставить("Свойство", Строка.Свойство);
			СтруктураСтрока.Вставить("Наименование", Строка(Строка.Свойство));
			ДобавитьДопРеквизит(HTMLТекст, Значение, СтруктураСтрока);
		КонецЕсли;	
	КонецЦикла;			
		
	HTMLТекст = HTMLТекст + "</td></tr>";	
		
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""2"">";
	
	HTMLТекст = HTMLТекст + "<p>";
	
	Если ЗначениеЗаполнено(РеквизитыОбъекта.ВидДокумента) И РеквизитыВида.ВестиУчетПоНоменклатуреДел
		И ЗначениеЗаполнено(РеквизитыОбъекта.НоменклатураДел) Тогда
			ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Номенклатура дел:'"), РеквизитыОбъекта.НоменклатураДел);
	КонецЕсли;
	
	HTMLТекст = HTMLТекст + "</td></tr>";
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""2"">";
	
	HTMLТекст = HTMLТекст + "<p>";
	
	Если ЗначениеЗаполнено(РеквизитыОбъекта.ВидДокумента) И РеквизитыВида.ИспользоватьПодписание
		И Не РеквизитыВида.ВестиУчетСторон И ЗначениеЗаполнено(РеквизитыОбъекта.Подписант) Тогда
			ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Подписывает:'"), РеквизитыОбъекта.Подписант);
	КонецЕсли;
	
	Если ЗначениеЗаполнено(РеквизитыОбъекта.ВидДокумента) И РеквизитыВида.ИспользоватьУтверждение Тогда
		ГрифыУтверждения = РеквизитыОбъекта.ГрифыУтверждения.Выгрузить();
		Если ГрифыУтверждения.Количество() > 0 Тогда
			ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Утверждает:'"), ГрифыУтверждения[0].АвторУтверждения);
		КонецЕсли;
	КонецЕсли;
	
	Если ЗначениеЗаполнено(РеквизитыОбъекта.Папка) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Папка:'"), РеквизитыОбъекта.Папка);
	КонецЕсли;
	
	Если ПолучитьФункциональнуюОпцию("ИспользоватьГрифыДоступа")
		И ЗначениеЗаполнено(РеквизитыОбъекта.ГрифДоступа) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Гриф:'"),  РеквизитыОбъекта.ГрифДоступа);
	КонецЕсли;
	
	Если ПолучитьФункциональнуюОпцию("ИспользоватьВопросыДеятельности")
		И ЗначениеЗаполнено(РеквизитыОбъекта.ВопросДеятельности) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Вопрос:'"),  РеквизитыОбъекта.ВопросДеятельности);
	КонецЕсли;
		
	Если ЗначениеЗаполнено(РеквизитыОбъекта.Ответственный) Тогда 
		ДобавитьВТекстДанныеКонтактногоЛица(РеквизитыОбъекта.Ответственный, HTMLТекст, НСтр("ru = 'Ответственный:'"));
	КонецЕсли;
	
	HTMLТекст = HTMLТекст + "</td></tr>";
	
	Если РеквизитыВида.ВестиУчетСторон И Объект.Стороны.Количество() Тогда
		HTMLТекст = HTMLТекст + "<td>";
		HTMLТекст = HTMLТекст + "<p>";
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Стороны:'"), "");
		HTMLТекст = HTMLТекст + "<p>";
		
		Для Каждого СтрокаСторона Из Объект.Стороны Цикл
			Если ЗначениеЗаполнено(СтрокаСторона.Наименование) Тогда
				ДобавитьПодпись(HTMLТекст, СокрЛП(СтрокаСторона.Наименование) + ": ");
			КонецЕсли;			
			
			ДобавитьЗначение(HTMLТекст, СтрокаСторона.Сторона, "");
			HTMLТекст = HTMLТекст + "<br>";
			
			ДобавитьВТекстДанныеКонтактногоЛица(СтрокаСторона.КонтактноеЛицо, HTMLТекст, НСтр("ru = 'Контакт:'"));
			
			HTMLТекст = HTMLТекст + "<p>";
		КонецЦикла;	
		
		// Удаление лишнего отступа
		HTMLТекст = Лев(HTMLТекст, СтрДлина(HTMLТекст)-3);
	ИначеЕсли РеквизитыВида.ВестиУчетПоКонтрагентам И Объект.Контрагенты.Количество() Тогда
		HTMLТекст = HTMLТекст + "<td>";
		HTMLТекст = HTMLТекст + "<p>";	
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Контрагенты:'"), "");
		HTMLТекст = HTMLТекст + "<p>";
		
		Для Каждого СтрокаКонтрагент Из Объект.Контрагенты Цикл
			Если ЗначениеЗаполнено(СтрокаКонтрагент.Контрагент) Тогда
				ДобавитьРеквизит(HTMLТекст, "", СтрокаКонтрагент.Контрагент);
			КонецЕсли;
			
			ДобавитьВТекстДанныеКонтактногоЛица(СтрокаКонтрагент.КонтактноеЛицо, HTMLТекст, НСтр("ru = 'Контакт:'"));
			
			HTMLТекст = HTMLТекст + "<p>";	
		КонецЦикла;	

		// Удаление лишнего отступа
		HTMLТекст = Лев(HTMLТекст, СтрДлина(HTMLТекст)-3);
	КонецЕсли;
	
	HTMLТекст = HTMLТекст + "<tr>";
	HTMLТекст = HTMLТекст + "<td>";
	
	Если ЗначениеЗаполнено(РеквизитыОбъекта.КомментарийКДокументу) Тогда
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Комментарий к документу:'"), РеквизитыОбъекта.КомментарийКДокументу);
	КонецЕсли;
	HTMLТекст = HTMLТекст + "</td>";
	HTMLТекст = HTMLТекст + "</tr>";
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""3"">";
	HTMLТекст = HTMLТекст + "<p>";
	Если ЗначениеЗаполнено(РеквизитыОбъекта.КомментарийКШаблону) Тогда			
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Комментарий к шаблону:'"), РеквизитыОбъекта.КомментарийКШаблону);
	КонецЕсли;
	HTMLТекст = HTMLТекст + "</td></tr>";
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td>";

	Если ЗначениеЗаполнено(РеквизитыОбъекта.Автор) Тогда
		ДобавитьВТекстДанныеКонтактногоЛица(
			РеквизитыОбъекта.Автор,
			HTMLТекст,
			НСтр("ru = 'Кому задавать вопросы по шаблону:'"));
	КонецЕсли;
	
	HTMLТекст = HTMLТекст + "</td></tr>";
	
	HTMLТекст = HTMLТекст + "</table>";
	HTMLТекст = HTMLТекст + "</body></html>";
	
	ОбзорОбъектовКлиентСервер.УдалитьВредоносныйКодИзТекста(HTMLТекст);
	
	Возврат HTMLТекст;
	
КонецФункции	

Функция ПолучитьОбзорШаблонаИсходящегоДокумента(Объект) Экспорт 
	
	HTMLТекст = ОбзорДокументаПереопределяемый.ПолучитьОбзорШаблонаИсходящегоДокумента(Объект);
	Если ЗначениеЗаполнено(HTMLТекст) Тогда 
		Возврат HTMLТекст;
	КонецЕсли;	
	
	РеквизитыОбъекта = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(Объект,
		"Организация, ВидДокумента, Заголовок, Содержание, НоменклатураДел,
		|ГрифДоступа, ВопросДеятельности, Ответственный, КомментарийКДокументу, КомментарийКШаблону,
		|Автор, Подписал");

	Организация = РеквизитыОбъекта.Организация;

	HTMLТекст = "<html>
	|<head>
	|<style type=""text/css"">
	|	body {
	|		overflow:    auto;
	|		margin-top:  6px; 		 
	|		margin-left: 10px; 
	|		font-family: Arial, sans-serif;
	|		font-size:   10pt;}
	|	table {
	|		width:       100%;
	|		font-family: Arial, sans-serif;
	|		font-size:   10pt;}
	|	td {vertical-align: top;}
	| 	a:link {
	|		color: #006699; text-decoration: none;}
	|	a:visited {
	|		color: #006699; text-decoration: none;}
	|	a:hover {
	|		color: #006699; text-decoration: underline;}
	|	p {
	|		margin-top: 7px;}
	|</style>
	|<body>";
	
	HTMLТекст = HTMLТекст + "<table>";
	HTMLТекст = HTMLТекст + "<tr>";
	
	HTMLТекст = HTMLТекст + "<td width=""40%"" align=center >";
	ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'От кого:'"), "");
	HTMLТекст = HTMLТекст + "<p>";
	ДобавитьРеквизит(HTMLТекст, "", Организация);
	
	HTMLТекст = HTMLТекст + "<p>";
	HTMLТекст = HTMLТекст + СтрШаблон(
		"<A href=v8doc:%1>%2</A>",
		ПолучитьНавигационнуюСсылку(РеквизитыОбъекта.ВидДокумента),
		ВРег(РаботаС_HTML.ЗаменитьСпецСимволыHTML(Строка(РеквизитыОбъекта.ВидДокумента))));
	HTMLТекст = HTMLТекст + "<p>";
	
		
	HTMLТекст = HTMLТекст + "<td width=""40%"">";
	
	Количество = 0;
	Для Каждого Получателя Из Объект.Получатели Цикл
		Если ЗначениеЗаполнено(Получателя.Получатель) Тогда
			Количество = Количество + 1;
		КонецЕсли;
	КонецЦикла;
	
	Если Количество > 0 Тогда 
		Если Количество = 1 Тогда 
			ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Кому:'"), "");
		Иначе 
			ДобавитьРеквизит(HTMLТекст, СтрШаблон(
				НСтр("ru = 'Кому (%1):'"), Количество), "");
		КонецЕсли;
		
		Для Каждого Получателя Из Объект.Получатели Цикл
			HTMLТекст = HTMLТекст + "<p>";
			ДобавитьРеквизит(HTMLТекст, "", Получателя.Получатель);
			
			Если ЗначениеЗаполнено(Получателя.Адресат) Тогда
				ДобавитьВТекстДанныеКонтактногоЛица(Получателя.Адресат, HTMLТекст, "");
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;
		
	HTMLТекст = HTMLТекст + "</td>";
	HTMLТекст = HTMLТекст + "</tr>";
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""3"">";
	
	HTMLТекст = HTMLТекст + "<p>";
	Заголовок = РеквизитыОбъекта.Заголовок;
	HTMLТекст = HTMLТекст + СтрШаблон(
		"<B>%1</B>",
		РаботаС_HTML.ЗаменитьСпецСимволыHTML(Заголовок));
	HTMLТекст = HTMLТекст + "<p>";	
		
	Если ЗначениеЗаполнено(РеквизитыОбъекта.Содержание) Тогда
		Содержание = РеквизитыОбъекта.Содержание;
		HTMLТекст = HTMLТекст + СтрЗаменить(РаботаС_HTML.ЗаменитьСпецСимволыHTML(Содержание), Символы.ПС, "<br>");
	КонецЕсли;	
		
	Для каждого Строка Из Объект.ДополнительныеРеквизиты Цикл
		Значение = Строка.Значение;
		Если Значение <> Неопределено или ЗначениеЗаполнено(Значение) Тогда
			СтруктураСтрока = Новый Структура;
			СтруктураСтрока.Вставить("Свойство", Строка.Свойство);
			СтруктураСтрока.Вставить("Наименование", Строка(Строка.Свойство));
			ДобавитьДопРеквизит(HTMLТекст, Значение, СтруктураСтрока);
		КонецЕсли;	
	КонецЦикла;	
		
	HTMLТекст = HTMLТекст + "</td></tr>";	
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""3"">";
	
	Если ЗначениеЗаполнено(РеквизитыОбъекта.Подписал) Тогда
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Подписал:'"), РеквизитыОбъекта.Подписал);
	КонецЕсли;	
			
	HTMLТекст = HTMLТекст + "</td></tr>";
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""3"">";
	
	Если ЗначениеЗаполнено(РеквизитыОбъекта.ВидДокумента) 
		И ОбщегоНазначения.ЗначениеРеквизитаОбъекта(РеквизитыОбъекта.ВидДокумента, "ВестиУчетПоНоменклатуреДел")
		И ЗначениеЗаполнено(РеквизитыОбъекта.НоменклатураДел) Тогда 
		HTMLТекст = HTMLТекст + "<p>";
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Номенклатура дел:'"), РеквизитыОбъекта.НоменклатураДел);
	КонецЕсли;
	
	HTMLТекст = HTMLТекст + "</td></tr>";
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""3"">";
	
	ИспользоватьГрифыДоступа = ПолучитьФункциональнуюОпцию("ИспользоватьГрифыДоступа");
	ИспользоватьВопросыДеятельности = ПолучитьФункциональнуюОпцию("ИспользоватьВопросыДеятельности");
	
	Если ИспользоватьГрифыДоступа Или ИспользоватьВопросыДеятельности Тогда
		HTMLТекст = HTMLТекст + "<p>";
	КонецЕсли;	
		
	Если ИспользоватьГрифыДоступа И ЗначениеЗаполнено(РеквизитыОбъекта.ГрифДоступа) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Гриф:'"),  РеквизитыОбъекта.ГрифДоступа);
	КонецЕсли;
	
	Если ИспользоватьВопросыДеятельности И ЗначениеЗаполнено(РеквизитыОбъекта.ВопросДеятельности) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Вопрос:'"),  РеквизитыОбъекта.ВопросДеятельности);
	КонецЕсли;
		
	Если ЗначениеЗаполнено(РеквизитыОбъекта.Ответственный) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Ответственный:'"),  РеквизитыОбъекта.Ответственный);
	КонецЕсли;
	
	HTMLТекст = HTMLТекст + "</td></tr>";	
	
	HTMLТекст = HTMLТекст + "<tr>";
	HTMLТекст = HTMLТекст + "<td colspan=""3"">";
	Если ЗначениеЗаполнено(РеквизитыОбъекта.КомментарийКДокументу) Тогда
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Комментарий к документу:'"), РеквизитыОбъекта.КомментарийКДокументу);
	КонецЕсли;
	HTMLТекст = HTMLТекст + "</td>";
	HTMLТекст = HTMLТекст + "</tr>";
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""3"">";
	Если ЗначениеЗаполнено(РеквизитыОбъекта.КомментарийКШаблону) Тогда			
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Комментарий к шаблону:'"), РеквизитыОбъекта.КомментарийКШаблону);
	КонецЕсли;
	HTMLТекст = HTMLТекст + "</td></tr>";
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""3"">";

	Если ЗначениеЗаполнено(РеквизитыОбъекта.Автор) Тогда
		ДобавитьВТекстДанныеКонтактногоЛица(
			РеквизитыОбъекта.Автор,
			HTMLТекст,
			НСтр("ru = 'Кому задавать вопросы по шаблону:'"));
	КонецЕсли;
	
	HTMLТекст = HTMLТекст + "</td></tr>";
	
	HTMLТекст = HTMLТекст + "</table>";
	HTMLТекст = HTMLТекст + "</body></html>";
	
	ОбзорОбъектовКлиентСервер.УдалитьВредоносныйКодИзТекста(HTMLТекст);
	
	Возврат HTMLТекст;
	
КонецФункции	

Функция ПолучитьОбзорШаблонаВходящегоДокумента(Объект) Экспорт 
	
	HTMLТекст = ОбзорДокументаПереопределяемый.ПолучитьОбзорШаблонаВходящегоДокумента(Объект);
	Если ЗначениеЗаполнено(HTMLТекст) Тогда 
		Возврат HTMLТекст;
	КонецЕсли;
	
	РеквизитыОбъекта = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(Объект,
		"Организация, ВидДокумента, Заголовок, Содержание, НоменклатураДел, Отправитель, Адресат,
		|ГрифДоступа, ВопросДеятельности, Ответственный, КомментарийКДокументу, КомментарийКШаблону,
		|Автор, Подписал, ДлительностьИсполнения");

	Организация = РеквизитыОбъекта.Организация;

	HTMLТекст = "<html>
	|<head>
	|<style type=""text/css"">
	|	body {
	|		overflow:    auto;
	|		margin-top:  6px; 		 
	|		margin-left: 10px; 
	|		font-family: Arial, sans-serif;
	|		font-size:   10pt;}
	|	table {
	|		width:       100%; 
	|		font-family: Arial, sans-serif;
	|		font-size:   10pt;}
	|	td {vertical-align: top;}
	| 	a:link {
	|		color: #006699; text-decoration: none;}
	|	a:visited {
	|		color: #006699; text-decoration: none;}
	|	a:hover {
	|		color: #006699; text-decoration: underline;}
	|	p {
	|		margin-top: 7px;}
	|</style>
	|<body>";
	
	HTMLТекст = HTMLТекст + "<table>";
	HTMLТекст = HTMLТекст + "<tr>";
	
	HTMLТекст = HTMLТекст + "<td width=""40%"" align=center >";
	ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'От кого:'"), "");
	HTMLТекст = HTMLТекст + "<p>";
	ДобавитьРеквизит(HTMLТекст, "", РеквизитыОбъекта.Отправитель);
	
	HTMLТекст = HTMLТекст + "<p>";
	HTMLТекст = HTMLТекст + СтрШаблон(
		"<A href=v8doc:%1>%2</A>",
		ПолучитьНавигационнуюСсылку(РеквизитыОбъекта.ВидДокумента),
		ВРег(РаботаС_HTML.ЗаменитьСпецСимволыHTML(Строка(РеквизитыОбъекта.ВидДокумента))));	
	HTMLТекст = HTMLТекст + "</td>";	
	
	HTMLТекст = HTMLТекст + "<td>";
	HTMLТекст = HTMLТекст + "</td>";
	
	HTMLТекст = HTMLТекст + "<td width=""40%"">";
	
	ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Кому:'"), "");
	HTMLТекст = HTMLТекст + "<p>";
	
	ДобавитьРеквизит(HTMLТекст, "", Организация);
	
	Если ЗначениеЗаполнено(РеквизитыОбъекта.Адресат) Тогда
		ДобавитьВТекстДанныеКонтактногоЛица(РеквизитыОбъекта.Адресат, HTMLТекст, "");
	КонецЕсли;
		
	HTMLТекст = HTMLТекст + "</td>";
	HTMLТекст = HTMLТекст + "</tr>";
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""3"">";
	
	HTMLТекст = HTMLТекст + "<p>";
	Заголовок = РеквизитыОбъекта.Заголовок;
	HTMLТекст = HTMLТекст + СтрШаблон(
		"<B>%1</B>",
		РаботаС_HTML.ЗаменитьСпецСимволыHTML(Заголовок));
	HTMLТекст = HTMLТекст + "</td>";
	HTMLТекст = HTMLТекст + "</tr>";
	HTMLТекст = HTMLТекст + "<tr>";
	HTMLТекст = HTMLТекст + "<td colspan=""3"">";
	Если ЗначениеЗаполнено(РеквизитыОбъекта.Содержание) Тогда
		Содержание = РеквизитыОбъекта.Содержание;
		HTMLТекст = HTMLТекст + СтрЗаменить(РаботаС_HTML.ЗаменитьСпецСимволыHTML(Содержание), Символы.ПС, "<br>");
	КонецЕсли;	
	
	Если ЗначениеЗаполнено(РеквизитыОбъекта.ДлительностьИсполнения) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Длительность исполнения (дней):'"), Формат(РеквизитыОбъекта.ДлительностьИсполнения, "ДЛФ=D"));
	КонецЕсли;
	
	Для каждого Строка Из Объект.ДополнительныеРеквизиты Цикл
		Значение = Строка.Значение;
		Если Значение <> Неопределено или ЗначениеЗаполнено(Значение) Тогда
			СтруктураСтрока = Новый Структура;
			СтруктураСтрока.Вставить("Свойство", Строка.Свойство);
			СтруктураСтрока.Вставить("Наименование", Строка(Строка.Свойство));
			ДобавитьДопРеквизит(HTMLТекст, Значение, СтруктураСтрока);
		КонецЕсли;	
	КонецЦикла;	
		
	HTMLТекст = HTMLТекст + "</td></tr>";	
	
	Если ЗначениеЗаполнено(РеквизитыОбъекта.Подписал) Тогда 
		
		HTMLТекст = HTMLТекст + "<tr>";
		HTMLТекст = HTMLТекст + "<td colspan=""3"">";
		
		Если ЗначениеЗаполнено(РеквизитыОбъекта.Подписал) Тогда
			ДобавитьВТекстДанныеКонтактногоЛица(РеквизитыОбъекта.Подписал, HTMLТекст, НСтр("ru = 'Подписал:'"));
		КонецЕсли;	
		
		HTMLТекст = HTMLТекст + "</td></tr>";
		
	КонецЕсли;	
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""3"">";
	
	ВестиУчетПоНоменклатуреДел = ЗначениеЗаполнено(РеквизитыОбъекта.ВидДокумента)
		И ОбщегоНазначения.ЗначениеРеквизитаОбъекта(РеквизитыОбъекта.ВидДокумента, "ВестиУчетПоНоменклатуреДел");
	
	Если ВестиУчетПоНоменклатуреДел И ЗначениеЗаполнено(РеквизитыОбъекта.НоменклатураДел) Тогда 
		HTMLТекст = HTMLТекст + "<p>";
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Номенклатура дел:'"), РеквизитыОбъекта.НоменклатураДел);
		HTMLТекст = HTMLТекст + "</td></tr>";
	КонецЕсли;
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""3"">";
	
	ИспользоватьГрифыДоступа = ПолучитьФункциональнуюОпцию("ИспользоватьГрифыДоступа");
	ИспользоватьВопросыДеятельности = ПолучитьФункциональнуюОпцию("ИспользоватьВопросыДеятельности");
	
	Если ИспользоватьГрифыДоступа Или ИспользоватьВопросыДеятельности Тогда
		HTMLТекст = HTMLТекст + "<p>";
	КонецЕсли;
		
	Если ИспользоватьГрифыДоступа И ЗначениеЗаполнено(РеквизитыОбъекта.ГрифДоступа) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Гриф:'"),  РеквизитыОбъекта.ГрифДоступа);
	КонецЕсли;
	
	Если ИспользоватьВопросыДеятельности И ЗначениеЗаполнено(РеквизитыОбъекта.ВопросДеятельности) Тогда
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Вопрос:'"),  РеквизитыОбъекта.ВопросДеятельности);
	КонецЕсли;
		
	Если ЗначениеЗаполнено(РеквизитыОбъекта.Ответственный) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Ответственный:'"),  РеквизитыОбъекта.Ответственный);
	КонецЕсли;
	
	HTMLТекст = HTMLТекст + "</td></tr>";	
	
	HTMLТекст = HTMLТекст + "<tr>";
	HTMLТекст = HTMLТекст + "<td colspan=""3"">";
	Если ЗначениеЗаполнено(РеквизитыОбъекта.КомментарийКДокументу) Тогда
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Комментарий к документу:'"), РеквизитыОбъекта.КомментарийКДокументу);
	КонецЕсли;
	HTMLТекст = HTMLТекст + "</td>";
	HTMLТекст = HTMLТекст + "</tr>";
	
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""3"">";
	HTMLТекст = HTMLТекст + "<p>";
	Если ЗначениеЗаполнено(РеквизитыОбъекта.КомментарийКШаблону) Тогда			
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Комментарий к шаблону:'"), РеквизитыОбъекта.КомментарийКШаблону);
	КонецЕсли;
	HTMLТекст = HTMLТекст + "</td></tr>";
	HTMLТекст = HTMLТекст + "<tr>";
    HTMLТекст = HTMLТекст + "<td colspan=""3"">";
	Если ЗначениеЗаполнено(РеквизитыОбъекта.Автор) Тогда			
		ДобавитьВТекстДанныеКонтактногоЛица(
			РеквизитыОбъекта.Автор,
			HTMLТекст,
			НСтр("ru = 'Кому задавать вопросы по шаблону:'"));
	КонецЕсли;
	
	HTMLТекст = HTMLТекст + "</td></tr>";
	
	HTMLТекст = HTMLТекст + "</table>";
	HTMLТекст = HTMLТекст + "</body></html>";
	
	ОбзорОбъектовКлиентСервер.УдалитьВредоносныйКодИзТекста(HTMLТекст);
	
	Возврат HTMLТекст;
	
КонецФункции	

Функция ПолучитьОбзорПроекта(Форма) Экспорт 

	Объект = Форма.Объект;
	Организация = Объект.Организация;
	
	// border-width: 1; border-style: solid; border-color: #413003;
	// Формируем основное представление документа	
	HTMLТекст = "<html>
	|<head>
	|<style type=""text/css"">
	|	body {
	|		overflow:    auto;
	|		margin-top:  6px;
	|		margin-left: 10px;
	|		margin-bottom: 0px;
	|		font-family: Arial, sans-serif;
	|		font-size:   10pt;}
	|	table {  
	|		width:       100%; 
	|		font-family: Arial, sans-serif;
	|		font-size:   10pt;}
	|	td {vertical-align: top;} 
	| 	a:link {
	|		color: #006699; text-decoration: none;}
	|	a:visited {
	|		color: #006699; text-decoration: none;}
	|	a:hover {
	|		color: #006699; text-decoration: underline;}
	|	p {
	|		margin-top: 7px; line-height: 1.3;}
	|</style>
	|<body>";
	
	
	HTMLТекст = HTMLТекст + "<table>";
	
	// Наименование и описание
	HTMLТекст = HTMLТекст + "<tr><td>";
	
	HTMLТекст = HTMLТекст + "<p>";
	Заголовок = Объект.Наименование;
	HTMLТекст = HTMLТекст + СтрШаблон(
		"<B>%1</B>",
		РаботаС_HTML.ЗаменитьСпецСимволыHTML(Заголовок));
		
	Если ЗначениеЗаполнено(Объект.Описание) Тогда
		HTMLТекст = HTMLТекст + "<p>";
		Содержание = Объект.Описание;
		HTMLТекст = HTMLТекст + СтрЗаменить(РаботаС_HTML.ЗаменитьСпецСимволыHTML(Содержание), Символы.ПС, "<br>");
	КонецЕсли;
		
	HTMLТекст = HTMLТекст + "</td></tr>";	
	
	// Руководитель и заказчик
	HTMLТекст = HTMLТекст + "<tr><td>";
	
	HTMLТекст = HTMLТекст + "<table>";
	HTMLТекст = HTMLТекст + "<tr>";
	HTMLТекст = HTMLТекст + "<td width=""400"" style=""padding:0;"">";
	
	HTMLТекст = HTMLТекст + "<p>";	
	Если ЗначениеЗаполнено(Объект.Руководитель) Тогда
		ДобавитьВТекстДанныеКонтактногоЛица(Объект.Руководитель, HTMLТекст, НСтр("ru = 'Руководитель:'"));
	КонецЕсли;
	
	HTMLТекст = HTMLТекст + "<p>";
	Если ЗначениеЗаполнено(Объект.ТекущийПланНачало) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Начало:'"), Формат(Объект.ТекущийПланНачало, "ДЛФ=D"));
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Объект.ТекущийПланОкончание) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Окончание:'"), Формат(Объект.ТекущийПланОкончание, "ДЛФ=D"));
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Объект.ТекущийПланТрудозатраты) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Трудозатраты:'"), 
			Строка(Объект.ТекущийПланТрудозатраты) + " " + Строка(Объект.ЕдиницаТрудозатратЗадач));
	КонецЕсли;
	ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Состояние:'"),  Объект.Состояние);
	
	HTMLТекст = HTMLТекст + "</td>";
	HTMLТекст = HTMLТекст + "<td style=""padding:0,5;"">";
	
	HTMLТекст = HTMLТекст + "<p>";	
	Если ЗначениеЗаполнено(Объект.Заказчик) Тогда
		ДобавитьВТекстДанныеКонтактногоЛица(Объект.Заказчик, HTMLТекст, НСтр("ru = 'Заказчик:'"));
	КонецЕсли;
	
	HTMLТекст = HTMLТекст + "<p>";
	ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Папка:'"), 	Объект.Папка);
	
	Если ПолучитьФункциональнуюОпцию("ИспользоватьГрифыДоступа") Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Гриф:'"),  Объект.ГрифДоступа);
	КонецЕсли;
	
	Если ПолучитьФункциональнуюОпцию("ИспользоватьВидыПроектов") Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Вид:'"),  Объект.ВидПроекта);
	КонецЕсли;
	
	HTMLТекст = HTMLТекст + "</td></tr>";
	HTMLТекст = HTMLТекст + "</table>";
	
	HTMLТекст = HTMLТекст + "</td></tr>";
	
	Если Объект.ПроектнаяКоманда.Количество() > 0 Тогда  
		HTMLТекст = HTMLТекст + "<tr><td>";
		HTMLТекст = HTMLТекст + "<table   style=""margin-top:5;  border-collapse: collapse; "">";
		
		HTMLТекст = HTMLТекст + "<tr>";
		HTMLТекст = HTMLТекст + "<td style=""padding-bottom:7;"" colspan=""3"">";
		
		HTMLТекст = HTMLТекст + СтрШаблон(
			"<A href=v8doc:%1>%2</A><BR>",
			"team",
			НСтр("ru = 'Проектная команда:'"));
		HTMLТекст = HTMLТекст + "</td>";	
		
		ЕстьЕмайл = Ложь;
		Для Каждого Строка Из Объект.ПроектнаяКоманда Цикл
			КонтактнаяИнформация = ПолучитьКонтактнуюИнформацияОбъекта(Строка.Исполнитель);
			Если ЗначениеЗаполнено(КонтактнаяИнформация.Емайл) Тогда
				ЕстьЕмайл = Истина;
				Прервать;
			КонецЕсли;	
		КонецЦикла;	
		
		Ном = 1;
		Для Каждого Строка Из Объект.ПроектнаяКоманда Цикл
			HTMLТекст = HTMLТекст + "<tr>";
			HTMLТекст = HTMLТекст + "<td width=""20"" style=""padding:5; border-width: 1; border-style: solid; border-color: #A0A0A0; "" align=""center""   >";
			ДобавитьРеквизит(HTMLТекст, , Ном);
			HTMLТекст = HTMLТекст + "</td>";
			
			HTMLТекст = HTMLТекст + "<td width=""365"" style=""padding:5; border-width: 1; border-style: solid; border-color: #A0A0A0; ""  >";
			ДобавитьРеквизит(HTMLТекст, , Строка.Исполнитель);
			HTMLТекст = HTMLТекст + "</td>";
			
			КонтактнаяИнформация = ПолучитьКонтактнуюИнформацияОбъекта(Строка.Исполнитель);
		
			Если ЕстьЕмайл Тогда 
				HTMLТекст = HTMLТекст + "<td width=""300"" style=""padding:5; border-width: 1; border-style: solid; border-color: #A0A0A0; "">";
			Иначе
				HTMLТекст = HTMLТекст + "<td>";
			КонецЕсли;	
			
			Если ЗначениеЗаполнено(КонтактнаяИнформация.Емайл) Тогда
				HTMLТекст = HTMLТекст + СтрШаблон(
					"<A color=#696969 href=v8doc:%1><FONT color=#696969>%2</FONT></A><BR>",
					"message"+КонтактнаяИнформация.Емайл,
					РаботаС_HTML.ЗаменитьСпецСимволыHTML(КонтактнаяИнформация.Емайл));
			КонецЕсли;
			HTMLТекст = HTMLТекст + "</td>";
			
			HTMLТекст = HTMLТекст + "<td>";
			HTMLТекст = HTMLТекст + "</td>";
			HTMLТекст = HTMLТекст + "</tr>";
			
			Ном = Ном + 1;
		КонецЦикла;	
		HTMLТекст = HTMLТекст + "</table>";
			
		HTMLТекст = HTMLТекст + "<p>";	
		HTMLТекст = HTMLТекст + "</td></tr>";
	КонецЕсли;
	
	HTMLТекст = HTMLТекст + "<tr><td>";
	
	Если Форма.Свойства_ИспользоватьСвойства Тогда 
		Для каждого Строка Из Форма.Свойства_ОписаниеДополнительныхРеквизитов Цикл
			Значение = Форма[Строка.ИмяРеквизитаЗначение];
			Если Не Строка.Удалено И ЗначениеЗаполнено(Значение) Тогда
				ДобавитьДопРеквизит(HTMLТекст, Значение, Строка);
			КонецЕсли;	
		КонецЦикла;	
	КонецЕсли;		
	
	Если ЗначениеЗаполнено(Объект.Комментарий) Тогда 
		ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Комментарий:'"),  Объект.Комментарий);
	КонецЕсли;
	
	HTMLТекст = HTMLТекст + "</td></tr>";	
	HTMLТекст = HTMLТекст + "</table>";
	
	HTMLТекст = HTMLТекст + "</body></html>";
	
	ОбзорОбъектовКлиентСервер.УдалитьВредоносныйКодИзТекста(HTMLТекст);
	
	Возврат HTMLТекст;
	
КонецФункции	

Функция ПолучитьОбзорПустогоШаблона() Экспорт 
	
	HTMLТекст = "<html>
	|<head>
	|<style type=""text/css"">
	|	body {
	|		overflow:    auto;
	|		margin-top:  6px; 		 
	|		margin-left: 10px; 
	|		font-family: Arial, sans-serif;
	|		font-size:   10pt;}
	|	table {
	|		width:       100%; 
	|		font-family: Arial, sans-serif;
	|		font-size:   10pt;}
	|	td {vertical-align: top;}
	| 	a:link {
	|		color: #006699; text-decoration: none;}
	|	a:visited {
	|		color: #006699; text-decoration: none;}
	|	a:hover {
	|		color: #006699; text-decoration: underline;}
	|	p {
	|		margin-top: 7px;}
	|</style>
	|<body>";
	
	HTMLТекст = HTMLТекст + "<table>";
	HTMLТекст = HTMLТекст + "<tr>";
	
	HTMLТекст = HTMLТекст + "<td width=""90%"" align=center >";
	ДобавитьРеквизит(HTMLТекст, НСтр("ru = 'Создать незаполненный документ'"), "");
	HTMLТекст = HTMLТекст + "<p>";
	HTMLТекст = HTMLТекст + "</td>";	
	
	HTMLТекст = HTMLТекст + "</td>";
	HTMLТекст = HTMLТекст + "</tr>";
	
	HTMLТекст = HTMLТекст + "</table>";
	HTMLТекст = HTMLТекст + "</body></html>";
	
	ОбзорОбъектовКлиентСервер.УдалитьВредоносныйКодИзТекста(HTMLТекст);
	
	Возврат HTMLТекст;
	
КонецФункции	

Функция РеквизитыХраненияИспользуются(НастройкаХранения, РеквизитХранения, ФормаДокумента)
	
	Если ПолучитьФункциональнуюОпцию("РаздельныйУчетДокументов") 
		И ФормаДокумента = Перечисления.ВариантыФормДокументов.Электронная Тогда 
		Возврат Ложь;
	КонецЕсли;
	
	ИспользоватьМестаХранения = ПолучитьФункциональнуюОпцию("ИспользоватьМестаХранения");
	Если ИспользоватьМестаХранения 
		И НастройкаХранения <> Перечисления.ВариантыИспользованияПолейХранения.НеУчитывать
		И ЗначениеЗаполнено(РеквизитХранения) Тогда 
		Возврат Истина;
	КонецЕсли;
	
	Возврат Ложь;
	
КонецФункции

// Выводит картинку статуса документа отчетности в контролирующие органы.
// 
// Параметры:
// 	Форма - ФормаКлиентскогоПриложения - форма, для элементов которой производится заполнение
// 	 * ЭтоОбменСКонтролирующимиОрганами - Булево
//	 * ЭлектронныйДокументОтчетностьВКО - ОпределяемыйТип.ПредметЦиклаОбмена
//	 * Объект - ДанныеФормыСтруктура
//	    ** Ссылка - СправочникСсылка.ВходящиеДокументы, СправочникСсылка.ИсходящиеДокументы
//	 * Элементы - ВсеЭлементыФормы
//	    ** КартинкаОтчетностьВКонтролирующиеОрганы
Процедура ВывестиКартинкуОтчетностиВКО(Форма) Экспорт 
	
	Если Не ПолучитьФункциональнуюОпцию("ИспользоватьОтчетностьВКонтролирующиеОрганы")
		Или Форма.ЭтоОбменСКонтролирующимиОрганами = Ложь Тогда
		Возврат;
	КонецЕсли;
	
	Если Не ЗначениеЗаполнено(Форма.ЭлектронныйДокументОтчетностьВКО) Тогда
		Возврат;
	КонецЕсли;
	
	Элементы = Форма.Элементы;
	
	Элементы.КартинкаОтчетностьВКонтролирующиеОрганы.Видимость = Истина;
	Если Элементы.КартинкаОтчетностьВКонтролирующиеОрганы.Рамка.ТипРамки <> Неопределено
		И Элементы.КартинкаОтчетностьВКонтролирующиеОрганы.Рамка.ТипРамки <> ТипРамкиЭлементаУправления.БезРамки Тогда
		Элементы.КартинкаОтчетностьВКонтролирующиеОрганы.Рамка = Новый Рамка(ТипРамкиЭлементаУправления.БезРамки);
	КонецЕсли;
	
	Если (РольДоступна("ЧтениеДанныхРегламентированнойОтчетностиДокументооборот")
		Или РольДоступна("ПолныеПрава")) Тогда
		Элементы.КартинкаОтчетностьВКонтролирующиеОрганы.Гиперссылка = Истина;
	КонецЕсли;
	
	Если ТипЗнч(Форма.Объект.Ссылка) = Тип("СправочникСсылка.ВходящиеДокументы") Тогда
		
		Подсказка = НСтр("ru = 'Документ получен от контролирующего органа'");
		СтатусОтчетностиВКонтролирующиеОрганы = 3;
		
	Иначе
	
		Сведения = ОтчетностьВКонтролирующиеОрганы.СведенияОбОтправкеЭлектронногоДокумента(
			Форма.ЭлектронныйДокументОтчетностьВКО);
		
		Если Сведения.Ссылка = Неопределено
			Или Не ЗначениеЗаполнено(Сведения.СтатусОтправки) Тогда
				
			Подсказка = НСтр("ru = 'Документ не отправлялся в контролирующий орган'");
			СтатусОтчетностиВКонтролирующиеОрганы = 0;
		Иначе
			
			СтатусОтправки = Сведения.СтатусОтправки;
			Подсказка = Строка(СтатусОтправки);
			
			Если СтатусОтправки = Перечисления.СтатусыОтправки.Отправлен Тогда
					СтатусОтчетностиВКонтролирующиеОрганы = 3;
					
				ИначеЕсли СтатусОтправки = Перечисления.СтатусыОтправки.Доставлен Тогда
					СтатусОтчетностиВКонтролирующиеОрганы = 4;
				
				ИначеЕсли СтатусОтправки = Перечисления.СтатусыОтправки.НеПринят Тогда
					СтатусОтчетностиВКонтролирующиеОрганы = 5;
				
				ИначеЕсли СтатусОтправки = Перечисления.СтатусыОтправки.Сдан Тогда
					СтатусОтчетностиВКонтролирующиеОрганы = 6;
				Иначе
					СтатусОтчетностиВКонтролирующиеОрганы = 1;
					Подсказка = НСтр("ru = 'Документ подготовлен к отправке'");
			КонецЕсли;
			
			
	
			Если Сведения.ПометкаУдаления Тогда
				СтатусОтчетностиВКонтролирующиеОрганы = СтатусОтчетностиВКонтролирующиеОрганы + 7;
			КонецЕсли;
			
		КонецЕсли;
		
	КонецЕсли;
	
	Элементы.КартинкаОтчетностьВКонтролирующиеОрганы.Подсказка = Подсказка;
	Форма.СтатусОтчетностиВКонтролирующиеОрганы = СтатусОтчетностиВКонтролирующиеОрганы;
	
КонецПроцедуры
